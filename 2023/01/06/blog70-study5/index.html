<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>冲毕业第六七八周记录 | TsuiWade's blog</title><meta name="keywords" content="科研"><meta name="author" content="tsuiwade"><meta name="copyright" content="tsuiwade"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="第6&#x2F;7&#x2F;8周的成果，一直在探索评价均匀性的指标，其中尝试过ks检验、kl散度，最终发现了熵的Kozachenko-Leonenko k近邻估计量这个方法。其中包括12.21开始的新冠，一直到12.29恢复工作。在发现了熵的评价标准后，12月31日尝试用动态规划进行求解，但耗时过长，然后从1月3号开始学习模拟退火直到1月6日完成一维数据实验。">
<meta property="og:type" content="article">
<meta property="og:title" content="冲毕业第六七八周记录">
<meta property="og:url" content="https://tsuiwade.github.io/2023/01/06/blog70-study5/index.html">
<meta property="og:site_name" content="TsuiWade&#39;s blog">
<meta property="og:description" content="第6&#x2F;7&#x2F;8周的成果，一直在探索评价均匀性的指标，其中尝试过ks检验、kl散度，最终发现了熵的Kozachenko-Leonenko k近邻估计量这个方法。其中包括12.21开始的新冠，一直到12.29恢复工作。在发现了熵的评价标准后，12月31日尝试用动态规划进行求解，但耗时过长，然后从1月3号开始学习模拟退火直到1月6日完成一维数据实验。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tsuiwade.github.io/rto3hzle5.hd-bkt.clouddn.com/image-20230106151805242.png">
<meta property="article:published_time" content="2023-01-06T21:16:25.000Z">
<meta property="article:modified_time" content="2023-01-06T21:16:25.000Z">
<meta property="article:author" content="tsuiwade">
<meta property="article:tag" content="科研">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tsuiwade.github.io/rto3hzle5.hd-bkt.clouddn.com/image-20230106151805242.png"><link rel="shortcut icon" href="/img/me.png"><link rel="canonical" href="https://tsuiwade.github.io/2023/01/06/blog70-study5/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-06 21:16:25'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/css/iconfont.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_2390943_bv078yuunhu.css"><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css"  media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="TsuiWade's blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.gif" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">70</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">23</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fas fa-chart-bar"></i><span> 统计</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/rto3hzle5.hd-bkt.clouddn.com/image-20230106151805242.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">TsuiWade's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fas fa-chart-bar"></i><span> 统计</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">冲毕业第六七八周记录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-06T21:16:25.000Z" title="发表于 2023-01-06 21:16:25">2023-01-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-01-06T21:16:25.000Z" title="更新于 2023-01-06 21:16:25">2023-01-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%A7%91%E7%A0%94/">科研</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>27分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>一些相关的文章</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/34313200/distribute-points-evenly-on-a-unit-hemisphere">Distribute points evenly on a unit hemisphere</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/25998937">https://zhuanlan.zhihu.com/p/25998937</a></p>
<p>但并不适用于矩形上选择</p>
<hr>
<p>突然发现一个很大的问题，我不能使用该方法来寻找星点，因为这种均匀分布是星点之间的角距的均匀分布，在观测时高度越高观测点越少，在高度低的地方观测点较多，其实并不适用于机架的校正。机架的校正应该按照经纬度网格来均匀选取。</p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20221214161314056.png" alt="image-20221214161314056"></p>
<p>那么其实就可以将头顶的天区展开为一个矩形，方位和高度为边的矩形，研究在矩形上的二维均匀分布。</p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20221214161442139.png" alt="image-20221214161442139"></p>
<p>浅画一下二维的高度方位图（5等星</p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20221214164714085.png" alt="image-20221214164714085"></p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20221214174203207.png" alt="image-20221214174203207"></p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20221214174257089.png" alt="image-20221214174257089"></p>
<hr>
<p>论文</p>
<p>Vedder, J.D.: ‘Star trackers, star catalog, and attitude determination: probabilistic aspects of system design’, J. Guid. Control Dyn., 1993, 16, (3), pp. 499–504</p>
<p>专利 《用于星敏感器的筛选导航星的方法》</p>
<p>2004 </p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20221216005037292.png" alt="image-20221216005037292"></p>
<hr>
<p>在Stack Overflow中找到了我想问问题的答案 </p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/13005294/measure-the-uniformity-of-distribution-of-points-in-a-2d-square">https://stackoverflow.com/questions/13005294/measure-the-uniformity-of-distribution-of-points-in-a-2d-square</a></p>
<p>通常在统计学中，我们需要了解给定的样本是否来自特定的分布，最常见的是正态分布(或高斯分布)。为此，我们有所谓的正态性检验，如夏皮罗-威尔克，安德森-达林或Kolmogorov-Smirnov检验。</p>
<p>它们都测量样本来自正态分布的可能性有多大，并有相关的p值来支持这种测量。</p>
<hr>
<p>就是KS检验。Kolmogorov-Smirnov test是一个有用的非参数（nonparmetric）假设检验，主要是用来检验一组样本是否来自于某个概率分布（one-sample K-S test），或者比较两组样本的分布是否相同（two-sample K-S test）。</p>
<p>ks检验返回两个值，pvalue是越高越好，统计量D-statistic越低越好</p>
<p>值的解释 </p>
<p><a target="_blank" rel="noopener" href="https://stats.stackexchange.com/questions/57885/how-to-interpret-p-value-of-kolmogorov-smirnov-test-python">https://stats.stackexchange.com/questions/57885/how-to-interpret-p-value-of-kolmogorov-smirnov-test-python</a></p>
<p><a target="_blank" rel="noopener" href="https://en.m.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test">https://en.m.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test</a></p>
<p>D 统计量是两个样本的 CDF 之间的绝对最大距离(最大值)。这个数字越接近于0，这两个样本就越有可能来自同一个分布。</p>
<p>K-s 检验返回的 p 值与其他 p 值具有相同的解释。如果 p 值小于你的显著性水平，那么你就拒绝了两个样本来自同一个分布的无效假设。如果您对该过程感兴趣，可以在线找到将 D 统计量转换为 p 值的表。</p>
<blockquote>
<p>最终返回的结果，p-value=4.7405805465370525e-159，比指定的显著水平（假设为5%）小，则我们完全可以拒绝假设：beta和norm不服从同一分布。</p>
</blockquote>
<p>学习一下ks检验 <strong>柯尔莫哥洛夫-斯米尔诺夫检验</strong>（英语：Kolmogorov-Smirnov test，简称K-S test），是一种基于累计分布函数的非参数检验，用以检验两个经验分布是否不同或一个经验分布与另一个理想分布是否不同。</p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20221216153934258.png" alt="image-20221216153934258"></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/292678346">https://zhuanlan.zhihu.com/p/292678346</a></p>
<p>α是置信系数</p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/v2-a831d74d745ccaf7ceb57110850bce5e_720w.webp" alt="img"></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/26477641">https://zhuanlan.zhihu.com/p/26477641</a></p>
<hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> ks_2samp</span><br><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> kstest</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">norm1 = [<span class="number">105</span>, <span class="number">108</span>, <span class="number">111</span>, <span class="number">112</span>, <span class="number">113</span>, <span class="number">113</span>, <span class="number">117</span>, <span class="number">128</span>, <span class="number">130</span>, <span class="number">131</span>]</span><br><span class="line">print(norm1)</span><br><span class="line">ks_value = kstest(norm1, <span class="string">&#x27;norm&#x27;</span>, args=(<span class="number">120</span>, <span class="number">10</span>))</span><br><span class="line">print(ks_value)</span><br></pre></td></tr></table></figure>
<p>KstestResult(statistic=0.35803634777692694, pvalue=0.11834016917515)</p>
<p>用一种简单的方式，我们可以将2样本检验的<code>KS统计量</code>D 定义为每个样本的cdf(累积分布函数)之间的最大距离，cdf 累计分布函数 <a target="_blank" rel="noopener" href="https://towardsdatascience.com/comparing-sample-distributions-with-the-kolmogorov-smirnov-ks-test-a2292ad6fee5">https://towardsdatascience.com/comparing-sample-distributions-with-the-kolmogorov-smirnov-ks-test-a2292ad6fee5</a></p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20221216193356448.png" alt="image-20221216193356448"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> kstest</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">norm1 = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line">print(norm1)</span><br><span class="line">ks_value = kstest(norm1, <span class="string">&#x27;uniform&#x27;</span>, args=(<span class="number">0</span>, <span class="number">10</span>), N=<span class="number">12</span>)</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line">KstestResult(statistic=<span class="number">0.09090909090909094</span>, pvalue=<span class="number">0.9998600940511319</span>)</span><br><span class="line">print(ks_value)</span><br></pre></td></tr></table></figure>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20221216203303976.png" alt="image-20221216203303976"></p>
<h2 id=""><a href="#" class="headerlink" title=""></a><figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">clc;clear;close all;</span><br><span class="line">x = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line">pd2 = makedist(<span class="string">&#x27;Uniform&#x27;</span>,<span class="string">&#x27;lower&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;upper&#x27;</span>,<span class="number">10</span>); <span class="comment">% Uniform distribution with a = -2 and b = 2</span></span><br><span class="line">t = <span class="number">0</span>:<span class="number">.01</span>:<span class="number">10</span>;</span><br><span class="line">cdf2 = cdf(pd2, t);</span><br><span class="line">h1 = cdfplot(x);</span><br><span class="line"><span class="built_in">hold</span> on</span><br><span class="line"><span class="built_in">plot</span>(t,cdf2,<span class="string">&#x27;k:&#x27;</span>,<span class="string">&#x27;LineWidth&#x27;</span>,<span class="number">2</span>);</span><br><span class="line">xlabel(<span class="string">&#x27;样本数据&#x27;</span>);</span><br><span class="line">ylabel(<span class="string">&#x27;累积分布函数F(x)&#x27;</span>);</span><br></pre></td></tr></table></figure></h2><p>试试实时方位数据</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> kstest</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">user_cols = [<span class="string">&#x27;hip&#x27;</span>, <span class="string">&#x27;az&#x27;</span>, <span class="string">&#x27;alt&#x27;</span>, <span class="string">&#x27;mag&#x27;</span>]</span><br><span class="line">pd_reader = pd.read_csv(<span class="string">&quot;./J2000_5_hor.csv&quot;</span>, header=<span class="literal">None</span>,</span><br><span class="line">                        engine=<span class="string">&#x27;python&#x27;</span>, index_col=<span class="number">0</span>, usecols=<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">4</span>)), names=user_cols)</span><br><span class="line">print(pd_reader.head())</span><br><span class="line">norm1 = pd_reader[<span class="string">&#x27;az&#x27;</span>]</span><br><span class="line">print(norm1)</span><br><span class="line">ks_value = kstest(norm1, <span class="string">&#x27;uniform&#x27;</span>, args=(<span class="number">0</span>, <span class="number">360</span>))</span><br><span class="line">print(ks_value)</span><br></pre></td></tr></table></figure>
<p>KstestResult(statistic=0.06621370056497172, pvalue=0.0038362399448040162)</p>
<p>实验感觉有问题 <a target="_blank" rel="noopener" href="https://bbs.pinggu.org/thread-2983774-1-1.html">https://bbs.pinggu.org/thread-2983774-1-1.html</a></p>
<p><a target="_blank" rel="noopener" href="https://stats.stackexchange.com/questions/153249/non-uniform-distribution-of-p-values-when-simulating-binomial-tests-under-the-nu/">https://stats.stackexchange.com/questions/153249/non-uniform-distribution-of-p-values-when-simulating-binomial-tests-under-the-nu/</a></p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20221216203556995.png" alt="image-20221216203556995"></p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">clc;clear;close all;</span><br><span class="line">M = csvread(<span class="string">&#x27;J2000_5_hor.csv&#x27;</span>);</span><br><span class="line">x = M(:, <span class="number">2</span>);</span><br><span class="line">pd2 = makedist(<span class="string">&#x27;Uniform&#x27;</span>,<span class="string">&#x27;lower&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;upper&#x27;</span>,<span class="number">360</span>); <span class="comment">% Uniform distribution with a = -2 and b = 2</span></span><br><span class="line">t = <span class="number">0</span>:<span class="number">.01</span>:<span class="number">360</span>;</span><br><span class="line">cdf2 = cdf(pd2, t);</span><br><span class="line">h1 = cdfplot(x);</span><br><span class="line"><span class="built_in">hold</span> on</span><br><span class="line"><span class="built_in">plot</span>(t,cdf2,<span class="string">&#x27;k:&#x27;</span>,<span class="string">&#x27;LineWidth&#x27;</span>,<span class="number">2</span>);</span><br><span class="line">xlabel(<span class="string">&#x27;样本数据&#x27;</span>);</span><br><span class="line">ylabel(<span class="string">&#x27;累积分布函数F(x)&#x27;</span>);</span><br><span class="line">xlim([<span class="number">0</span> <span class="number">360</span>])</span><br><span class="line">ylim([<span class="number">0</span> <span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20221230230221109.png" alt="image-20221230230221109"></p>
<hr>
<p>ks检验还是到此为止了，毕竟还只是个检验方法，不算指标</p>
<p>检验数据是否服从指定分布的方法有</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Datawhale/article/details/120558925">https://blog.csdn.net/Datawhale/article/details/120558925</a></p>
<p>可知 KS检验的灵敏度没有相应的检验来的高</p>
<p>在该文中提到KL 散度是一种衡量两个概率分布的匹配程度的指标，两个分布差异越大，KL散度越大。KL越小越接近。</p>
<p>有人会把KL散度认为是一种距离指标，然而，KL散度不能用来衡量两个分布的距离。其原因在于KL散度不是对称的。举例来说，如果用观测分布来近似二项分布，其KL散度为</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/153492607">https://zhuanlan.zhihu.com/p/153492607</a></p>
<p>感觉不太合适，所以作罢</p>
<hr>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45654781/article/details/126862808">https://blog.csdn.net/qq_45654781/article/details/126862808</a></p>
<p><strong><code>计算 Kozachenko-Leonenko的k最近邻估计熵</code></strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/kuxing-pretty/entropy_estimators">https://github.com/paulbrodersen/entropy_estimators</a></p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20230103103217539.png" alt="image-20230103103217539"></p>
<p>4等星 214个选20个</p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20230103155149727.png" alt="image-20230103155149727"></p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20230103155239749.png" alt="image-20230103155239749"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">from scipy.special <span class="keyword">import</span> gamma, digamma</span><br><span class="line"><span class="keyword">import</span> numpy as np</span><br><span class="line">from entropy_estimators <span class="keyword">import</span> continuous</span><br><span class="line"></span><br><span class="line"><span class="meta"># create some normal test data</span></span><br><span class="line"># X = np.random.randn(<span class="number">20000</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"># X = np.arange(<span class="number">0</span>, <span class="number">0.09</span>, <span class="number">0.01</span>)</span><br><span class="line"># X = np.<span class="built_in">array</span>([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])</span><br><span class="line"># X = np.<span class="built_in">array</span>([<span class="number">189.83</span> <span class="number">195.095</span> <span class="number">195.192</span> <span class="number">196.886</span> <span class="number">198.814</span> <span class="number">203.376</span> <span class="number">204.429</span> <span class="number">218.318</span> <span class="number">227.266</span> <span class="number">261.36</span> <span class="number">301.009</span> <span class="number">308.907</span> <span class="number">345.333</span>])</span><br><span class="line"><span class="meta"># dp 前a个点 选b个点 最后一次选的是c点 倒数第二次选的是d点</span></span><br><span class="line"><span class="meta"># dp[3][3][3][2] dp[4][4][4][3]</span></span><br><span class="line">X = np.<span class="built_in">array</span>([<span class="number">189.83</span>, <span class="number">261.36</span>, <span class="number">301.009</span>, <span class="number">345.333</span>])</span><br><span class="line">#            <span class="number">261</span><span class="number">-189</span>  <span class="number">301</span><span class="number">-261</span> <span class="number">301</span><span class="number">-261</span>  <span class="number">345</span><span class="number">-301</span></span><br><span class="line"></span><br><span class="line">print(X.shape)</span><br><span class="line"><span class="meta"># compute the entropy from the determinant of the multivariate normal distribution:</span></span><br><span class="line">analytic = continuous.get_h_mvn(X)</span><br><span class="line"></span><br><span class="line"><span class="meta"># compute the entropy using the k-nearest neighbour approach</span></span><br><span class="line"><span class="meta"># developed by Kozachenko and Leonenko (1,987):</span></span><br><span class="line">kozachenko = continuous.get_h(X, k=1, norm=&#x27;euclidean&#x27;)</span><br><span class="line"></span><br><span class="line">print(f<span class="string">&quot;analytic result: &#123;analytic:.5f&#125;&quot;</span>)</span><br><span class="line">print(f<span class="string">&quot;K-L estimator: &#123;kozachenko:.5f&#125;&quot;</span>)</span><br><span class="line">print(digamma(<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<p>运算时间很慢</p>
<p>用c++写dp（这个dp还没考虑球体的循环问题）</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;boost/math/special_functions/digamma.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(linker, <span class="meta-string">&quot;/STACK:1073741824&quot;</span>)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">// vector&lt;double&gt; points = &#123;0.1, 1.2, 1.9, 2.3, 2.9, 3.9&#125;;</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt; points = &#123;<span class="number">261.36</span>, <span class="number">345.333</span>, <span class="number">218.318</span>, <span class="number">196.886</span>, <span class="number">187.195</span>, <span class="number">187.387</span>, <span class="number">349.435</span>, <span class="number">262.478</span>, <span class="number">352.194</span>, <span class="number">186.59</span>, <span class="number">355.361</span>, <span class="number">358.033</span>, <span class="number">347.135</span>, <span class="number">179.794</span>, <span class="number">179.51</span>, <span class="number">178.597</span>, <span class="number">14.876</span>, <span class="number">172.61</span>, <span class="number">5.50809</span>, <span class="number">175.587</span>, <span class="number">158.055</span>, <span class="number">175.579</span>, <span class="number">18.0717</span>, <span class="number">18.0694</span>, <span class="number">167.389</span>, <span class="number">163.211</span>, <span class="number">98.636</span>, <span class="number">135.693</span>, <span class="number">10.1721</span>, <span class="number">131.4</span>, <span class="number">172.071</span>, <span class="number">152.177</span>, <span class="number">6.69029</span>, <span class="number">43.8872</span>, <span class="number">117.085</span>, <span class="number">72.1644</span>, <span class="number">168.928</span>, <span class="number">0.366764</span>, <span class="number">135.911</span>, <span class="number">94.3341</span>, <span class="number">29.6564</span>, <span class="number">158.157</span>, <span class="number">129.038</span>, <span class="number">35.8318</span>, <span class="number">65.4447</span>, <span class="number">60.8557</span>, <span class="number">52.6322</span>, <span class="number">150.143</span>, <span class="number">144.502</span>, <span class="number">44.7996</span>, <span class="number">117.286</span>, <span class="number">115.854</span>, <span class="number">133.016</span>, <span class="number">50.1732</span>, <span class="number">130.872</span>, <span class="number">78.2541</span>, <span class="number">92.0012</span>, <span class="number">59.5689</span>, <span class="number">91.4648</span>, <span class="number">91.6474</span>, <span class="number">91.4945</span>, <span class="number">78.2767</span>, <span class="number">64.2761</span>, <span class="number">130.576</span>, <span class="number">105.338</span>, <span class="number">112.139</span>, <span class="number">51.6668</span>, <span class="number">140.95</span>, <span class="number">98.267</span>, <span class="number">95.4699</span>, <span class="number">92.6435</span>, <span class="number">96.5942</span>, <span class="number">135.931</span>, <span class="number">94.7702</span>, <span class="number">114.749</span>, <span class="number">113.036</span>, <span class="number">102.779</span>, <span class="number">103.887</span>, <span class="number">106.395</span>, <span class="number">71.9267</span>, <span class="number">57.5453</span>, <span class="number">61.2187</span>, <span class="number">125.211</span>, <span class="number">60.8502</span>, <span class="number">110.887</span>, <span class="number">119.231</span>, <span class="number">112.454</span>, <span class="number">54.2793</span>, <span class="number">110.83</span>, <span class="number">105.955</span>, <span class="number">97.9926</span>, <span class="number">74.9688</span>, <span class="number">120.518</span>, <span class="number">102.988</span>, <span class="number">117.519</span>, <span class="number">93.22</span>, <span class="number">107.316</span>, <span class="number">103.157</span>, <span class="number">81.8369</span>, <span class="number">103.996</span>, <span class="number">103.994</span>, <span class="number">103.133</span>, <span class="number">119.554</span>, <span class="number">113.025</span>, <span class="number">108.66</span>, <span class="number">117.34</span>, <span class="number">92.8309</span>, <span class="number">111.149</span>, <span class="number">42.8763</span>, <span class="number">53.886</span>, <span class="number">62.5918</span>, <span class="number">76.2882</span>, <span class="number">75.3801</span>, <span class="number">100.752</span>, <span class="number">79.2899</span>, <span class="number">70.6052</span>, <span class="number">81.4649</span>, <span class="number">61.3945</span>, <span class="number">74.194</span>, <span class="number">69.2536</span>, <span class="number">63.5351</span>, <span class="number">58.963</span>, <span class="number">64.2205</span>, <span class="number">61.0484</span>, <span class="number">28.6315</span>, <span class="number">36.2729</span>, <span class="number">36.4375</span>, <span class="number">22.0025</span>, <span class="number">29.8624</span>, <span class="number">22.9935</span>, <span class="number">16.475</span>, <span class="number">13.928</span>, <span class="number">8.27138</span>, <span class="number">2.78788</span>, <span class="number">353.602</span>, <span class="number">352.709</span>, <span class="number">349.577</span>, <span class="number">342.741</span>, <span class="number">338.205</span>, <span class="number">337.806</span>, <span class="number">314.748</span>, <span class="number">325.078</span>, <span class="number">319.051</span>, <span class="number">327.003</span>, <span class="number">322.017</span>, <span class="number">303.285</span>, <span class="number">301.663</span>, <span class="number">340.939</span>, <span class="number">307.003</span>, <span class="number">300.783</span>, <span class="number">310.137</span>, <span class="number">299.254</span>, <span class="number">281.805</span>, <span class="number">334.071</span>, <span class="number">318.207</span>, <span class="number">269.96</span>, <span class="number">315.802</span>, <span class="number">291.564</span>, <span class="number">307.793</span>, <span class="number">273.792</span>, <span class="number">280.855</span>, <span class="number">336.666</span>, <span class="number">271.656</span>, <span class="number">268.879</span>, <span class="number">280.421</span>, <span class="number">260.389</span>, <span class="number">308.107</span>, <span class="number">249.547</span>, <span class="number">247.287</span>, <span class="number">300.084</span>, <span class="number">268.299</span>, <span class="number">270.919</span>, <span class="number">271.962</span>, <span class="number">305.234</span>, <span class="number">326.502</span>, <span class="number">291.083</span>, <span class="number">247.667</span>, <span class="number">299.381</span>, <span class="number">302.746</span>, <span class="number">284.357</span>, <span class="number">294.458</span>, <span class="number">328.324</span>, <span class="number">231.173</span>, <span class="number">338.978</span>, <span class="number">243.665</span>, <span class="number">233.148</span>, <span class="number">324.253</span>, <span class="number">256.191</span>, <span class="number">232.279</span>, <span class="number">216.426</span>, <span class="number">241.766</span>, <span class="number">272.257</span>, <span class="number">208.418</span>, <span class="number">247.348</span>, <span class="number">325.249</span>, <span class="number">237.343</span>, <span class="number">236.978</span>, <span class="number">314.613</span>, <span class="number">245.759</span>, <span class="number">203.524</span>, <span class="number">276.607</span>, <span class="number">200.523</span>, <span class="number">339.604</span>, <span class="number">265.049</span>, <span class="number">224.551</span>, <span class="number">218.172</span>, <span class="number">209.523</span>, <span class="number">302.305</span>, <span class="number">269.956</span>, <span class="number">245.845</span>, <span class="number">211.412</span>, <span class="number">227.112</span>, <span class="number">317.642</span>, <span class="number">353.915</span>&#125;;</span><br><span class="line"><span class="comment">// vector&lt;double&gt; points(point.begin(), point.begin() + 50);</span></span><br><span class="line"><span class="keyword">double</span> log_c_d = (<span class="number">1</span> / <span class="number">2.</span>) * <span class="built_in">log</span>(M_PI) - <span class="built_in">log</span>(tgamma(<span class="number">1</span> / <span class="number">2.</span> + <span class="number">1</span>));</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span> j, <span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> distances = points[j - <span class="number">1</span>] - points[k - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">double</span> sum_log_dist = <span class="number">2</span> * <span class="built_in">log</span>(<span class="number">2</span> * distances);</span><br><span class="line">    <span class="keyword">double</span> h = -boost::math::digamma(<span class="number">1</span>) + boost::math::digamma(<span class="number">2</span>) + log_c_d + (<span class="number">1</span> / <span class="number">2.0</span>) * sum_log_dist;</span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = points.size();</span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; n &quot;</span> &lt;&lt; n &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    sort(points.begin(), points.end());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">double</span> num : points)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; num &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// double dp[51][21][51][51];</span></span><br><span class="line">    <span class="comment">// memset(dp, 0, sizeof(dp));</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt;&gt;&gt;&gt; dp(n + <span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt;&gt;&gt;(m + <span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt;&gt;(n + <span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt;(n + <span class="number">1</span>))));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; 1&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = i - <span class="number">1</span>; k &gt;= <span class="number">1</span>; k--)</span><br><span class="line">            dp[i][<span class="number">2</span>][i][k] = func(i, k);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> a = <span class="number">3</span>; a &lt;= n; a++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> b = <span class="number">2</span>; b &lt;= m; b++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> c = b; c &lt;= a; c++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> d = b - <span class="number">1</span>; d &lt;= a - <span class="number">1</span> &amp;&amp; d &lt;= c - <span class="number">1</span>; d++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (c == a &amp;&amp; b == <span class="number">2</span>)</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span> (c != a)</span><br><span class="line">                    &#123; <span class="comment">// 没选a</span></span><br><span class="line">                        dp[a][b][c][d] = dp[a - <span class="number">1</span>][b][c][d];<span class="comment">//120^4 * 20 dp 前a个点 选b个点 最后一次选的是c点 倒数第二次选的是d点  筛选问题 700 选 50 </span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> e = b - <span class="number">2</span>; e &lt;= d - <span class="number">1</span>; e++)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">double</span> last = dp[a - <span class="number">1</span>][b - <span class="number">1</span>][d][e];</span><br><span class="line">                            <span class="keyword">double</span> newv = ((last + boost::math::digamma(<span class="number">1</span>) - boost::math::digamma(b - <span class="number">1</span>) - log_c_d) * (b - <span class="number">1</span>) - <span class="built_in">log</span>(<span class="number">2</span> * (points[d - <span class="number">1</span>] - points[e - <span class="number">1</span>])) + <span class="built_in">log</span>(<span class="number">2</span> * (points[c - <span class="number">1</span>] - points[d - <span class="number">1</span>])) + <span class="built_in">log</span>(<span class="number">2</span> * min(points[c - <span class="number">1</span>] - points[d - <span class="number">1</span>], points[d - <span class="number">1</span>] - points[e - <span class="number">1</span>]))) / <span class="keyword">double</span>(b) - boost::math::digamma(<span class="number">1</span>) + boost::math::digamma(b) + log_c_d;</span><br><span class="line">                            <span class="comment">// if ( a == 4 &amp;&amp; b == 3 &amp;&amp; c)</span></span><br><span class="line">                            dp[a][b][c][d] = max(dp[a][b][c][d], newv);</span><br><span class="line">                            <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; a &quot;</span> &lt;&lt; a &lt;&lt; <span class="string">&quot; b &quot;</span> &lt;&lt; b &lt;&lt; <span class="string">&quot; c &quot;</span> &lt;&lt; c &lt;&lt; <span class="string">&quot; d &quot;</span> &lt;&lt; d &lt;&lt; <span class="string">&quot; e &quot;</span> &lt;&lt; e &lt;&lt; <span class="string">&quot; dp &quot;</span> &lt;&lt; dp[a][b][c][d] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// double maxv = 0.0;</span></span><br><span class="line">    <span class="comment">// int a = 13, b = 4;</span></span><br><span class="line">    <span class="comment">// int cc, dd;</span></span><br><span class="line">    <span class="comment">// // while (d &gt; 1)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     for (int c = b; c &lt;= a; c++)</span></span><br><span class="line">    <span class="comment">//         for (int d = b - 1; d &lt;= a - 1 &amp;&amp; d &lt;= c - 1; d++)</span></span><br><span class="line">    <span class="comment">//             if (dp[a][b][c][d] &gt; maxv)</span></span><br><span class="line">    <span class="comment">//             &#123;</span></span><br><span class="line">    <span class="comment">//                 maxv = dp[a][b][c][d];</span></span><br><span class="line">    <span class="comment">//                 cc = c;</span></span><br><span class="line">    <span class="comment">//                 dd = d;</span></span><br><span class="line">    <span class="comment">//             &#125;</span></span><br><span class="line">    <span class="comment">//     cout &lt;&lt; &quot; cc &quot; &lt;&lt; cc &lt;&lt; &quot; dd &quot; &lt;&lt; dd &lt;&lt; &quot; dp &quot; &lt;&lt; maxv &lt;&lt; endl;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> maxv = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> a = n, b = m, c = a;</span><br><span class="line">    <span class="keyword">int</span> dd = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">while</span> (dd &gt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> d = c - <span class="number">1</span>; d &gt;= b - <span class="number">1</span>; d--)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (dp[a][b][c][d] &gt; maxv)</span><br><span class="line">            &#123;</span><br><span class="line">                maxv = dp[a][b][c][d];</span><br><span class="line">                dd = d;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; dd &quot;</span> &lt;&lt; dd &lt;&lt; <span class="string">&quot; dp &quot;</span> &lt;&lt; maxv &lt;&lt; <span class="string">&quot; a &quot;</span> &lt;&lt; a &lt;&lt; <span class="string">&quot; b &quot;</span> &lt;&lt; b &lt;&lt; <span class="string">&quot; c &quot;</span> &lt;&lt; c &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        a = dd;</span><br><span class="line">        c = a;</span><br><span class="line">        maxv = <span class="number">0.0</span>;</span><br><span class="line">        b--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>采用模拟退火进行加速运算</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1hK41157JL/?spm_id_from=333.337.search-card.all.click&amp;vd_source=6c92aa3e5d0f2e0347ec135013a906d8">https://www.bilibili.com/video/BV1hK41157JL/?spm_id_from=333.337.search-card.all.click&amp;vd_source=6c92aa3e5d0f2e0347ec135013a906d8</a></p>
<p>b站教程不错</p>
<p>选用第三个例题《书店买书》的案例</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/001Klrt7jjf8s5rI3py7Yg">https://mp.weixin.qq.com/s/001Klrt7jjf8s5rI3py7Yg</a></p>
<hr>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">clear all;close all; clc;</span><br><span class="line">points = [<span class="number">261.36</span>,<span class="number">345.333</span>,<span class="number">218.318</span>,<span class="number">196.886</span>,<span class="number">187.195</span>,<span class="number">187.387</span>,<span class="number">349.435</span>,<span class="number">262.478</span>,<span class="number">352.194</span>,<span class="number">186.59</span>,<span class="number">355.361</span>,<span class="number">358.033</span>,<span class="number">347.135</span>,<span class="number">179.794</span>,<span class="number">179.51</span>,<span class="number">178.597</span>,<span class="number">14.876</span>,<span class="number">172.61</span>,<span class="number">5.50809</span>,<span class="number">175.587</span>,<span class="number">158.055</span>,<span class="number">175.579</span>,<span class="number">18.0717</span>,<span class="number">18.0694</span>,<span class="number">167.389</span>,<span class="number">163.211</span>,<span class="number">98.636</span>,<span class="number">135.693</span>,<span class="number">10.1721</span>,<span class="number">131.4</span>,<span class="number">172.071</span>,<span class="number">152.177</span>,<span class="number">6.69029</span>,<span class="number">43.8872</span>,<span class="number">117.085</span>,<span class="number">72.1644</span>,<span class="number">168.928</span>,<span class="number">0.366764</span>,<span class="number">135.911</span>,<span class="number">94.3341</span>,<span class="number">29.6564</span>,<span class="number">158.157</span>,<span class="number">129.038</span>,<span class="number">35.8318</span>,<span class="number">65.4447</span>,<span class="number">60.8557</span>,<span class="number">52.6322</span>,<span class="number">150.143</span>,<span class="number">144.502</span>,<span class="number">44.7996</span>,<span class="number">117.286</span>,<span class="number">115.854</span>,<span class="number">133.016</span>,<span class="number">50.1732</span>,<span class="number">130.872</span>,<span class="number">78.2541</span>,<span class="number">92.0012</span>,<span class="number">59.5689</span>,<span class="number">91.4648</span>,<span class="number">91.6474</span>,<span class="number">91.4945</span>,<span class="number">78.2767</span>,<span class="number">64.2761</span>,<span class="number">130.576</span>,<span class="number">105.338</span>,<span class="number">112.139</span>,<span class="number">51.6668</span>,<span class="number">140.95</span>,<span class="number">98.267</span>,<span class="number">95.4699</span>,<span class="number">92.6435</span>,<span class="number">96.5942</span>,<span class="number">135.931</span>,<span class="number">94.7702</span>,<span class="number">114.749</span>,<span class="number">113.036</span>,<span class="number">102.779</span>,<span class="number">103.887</span>,<span class="number">106.395</span>,<span class="number">71.9267</span>,<span class="number">57.5453</span>,<span class="number">61.2187</span>,<span class="number">125.211</span>,<span class="number">60.8502</span>,<span class="number">110.887</span>,<span class="number">119.231</span>,<span class="number">112.454</span>,<span class="number">54.2793</span>,<span class="number">110.83</span>,<span class="number">105.955</span>,<span class="number">97.9926</span>,<span class="number">74.9688</span>,<span class="number">120.518</span>,<span class="number">102.988</span>,<span class="number">117.519</span>,<span class="number">93.22</span>,<span class="number">107.316</span>,<span class="number">103.157</span>,<span class="number">81.8369</span>,<span class="number">103.996</span>,<span class="number">103.994</span>,<span class="number">103.133</span>,<span class="number">119.554</span>,<span class="number">113.025</span>,<span class="number">108.66</span>,<span class="number">117.34</span>,<span class="number">92.8309</span>,<span class="number">111.149</span>,<span class="number">42.8763</span>,<span class="number">53.886</span>,<span class="number">62.5918</span>,<span class="number">76.2882</span>,<span class="number">75.3801</span>,<span class="number">100.752</span>,<span class="number">79.2899</span>,<span class="number">70.6052</span>,<span class="number">81.4649</span>,<span class="number">61.3945</span>,<span class="number">74.194</span>,<span class="number">69.2536</span>,<span class="number">63.5351</span>,<span class="number">58.963</span>,<span class="number">64.2205</span>,<span class="number">61.0484</span>,<span class="number">28.6315</span>,<span class="number">36.2729</span>,<span class="number">36.4375</span>,<span class="number">22.0025</span>,<span class="number">29.8624</span>,<span class="number">22.9935</span>,<span class="number">16.475</span>,<span class="number">13.928</span>,<span class="number">8.27138</span>,<span class="number">2.78788</span>,<span class="number">353.602</span>,<span class="number">352.709</span>,<span class="number">349.577</span>,<span class="number">342.741</span>,<span class="number">338.205</span>,<span class="number">337.806</span>,<span class="number">314.748</span>,<span class="number">325.078</span>,<span class="number">319.051</span>,<span class="number">327.003</span>,<span class="number">322.017</span>,<span class="number">303.285</span>,<span class="number">301.663</span>,<span class="number">340.939</span>,<span class="number">307.003</span>,<span class="number">300.783</span>,<span class="number">310.137</span>,<span class="number">299.254</span>,<span class="number">281.805</span>,<span class="number">334.071</span>,<span class="number">318.207</span>,<span class="number">269.96</span>,<span class="number">315.802</span>,<span class="number">291.564</span>,<span class="number">307.793</span>,<span class="number">273.792</span>,<span class="number">280.855</span>,<span class="number">336.666</span>,<span class="number">271.656</span>,<span class="number">268.879</span>,<span class="number">280.421</span>,<span class="number">260.389</span>,<span class="number">308.107</span>,<span class="number">249.547</span>,<span class="number">247.287</span>,<span class="number">300.084</span>,<span class="number">268.299</span>,<span class="number">270.919</span>,<span class="number">271.962</span>,<span class="number">305.234</span>,<span class="number">326.502</span>,<span class="number">291.083</span>,<span class="number">247.667</span>,<span class="number">299.381</span>,<span class="number">302.746</span>,<span class="number">284.357</span>,<span class="number">294.458</span>,<span class="number">328.324</span>,<span class="number">231.173</span>,<span class="number">338.978</span>,<span class="number">243.665</span>,<span class="number">233.148</span>,<span class="number">324.253</span>,<span class="number">256.191</span>,<span class="number">232.279</span>,<span class="number">216.426</span>,<span class="number">241.766</span>,<span class="number">272.257</span>,<span class="number">208.418</span>,<span class="number">247.348</span>,<span class="number">325.249</span>,<span class="number">237.343</span>,<span class="number">236.978</span>,<span class="number">314.613</span>,<span class="number">245.759</span>,<span class="number">203.524</span>,<span class="number">276.607</span>,<span class="number">200.523</span>,<span class="number">339.604</span>,<span class="number">265.049</span>,<span class="number">224.551</span>,<span class="number">218.172</span>,<span class="number">209.523</span>,<span class="number">302.305</span>,<span class="number">269.956</span>,<span class="number">245.845</span>,<span class="number">211.412</span>,<span class="number">227.112</span>,<span class="number">317.642</span>,<span class="number">353.915</span>];</span><br><span class="line"></span><br><span class="line">points = <span class="built_in">sort</span>(points);</span><br><span class="line"></span><br><span class="line">chose = int16([<span class="number">1</span> <span class="number">12</span> <span class="number">15</span> <span class="number">50</span> <span class="number">60</span> <span class="number">89</span> <span class="number">98</span> <span class="number">99</span> <span class="number">106</span> <span class="number">124</span> <span class="number">126</span> <span class="number">131</span> <span class="number">133</span> <span class="number">134</span> <span class="number">150</span> <span class="number">151</span> <span class="number">165</span> <span class="number">202</span> <span class="number">206</span> <span class="number">207</span>]);</span><br><span class="line">chose = <span class="built_in">sort</span>(chose);</span><br><span class="line"></span><br><span class="line"><span class="built_in">scatter</span>(points,<span class="number">0</span>,<span class="string">&#x27;k.&#x27;</span>);</span><br><span class="line"><span class="built_in">hold</span> on;</span><br><span class="line"><span class="keyword">for</span> s = chose</span><br><span class="line">    <span class="built_in">disp</span>(s);</span><br><span class="line">    <span class="built_in">scatter</span>(points(s), <span class="number">0</span>,<span class="string">&#x27;red&#x27;</span>,<span class="string">&#x27;filled&#x27;</span>);</span><br><span class="line">    <span class="built_in">hold</span> on;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>初始方案是：<br>[1 12 15 50 60 89 98 99 106 124 126 131 133 134 150 151 165 202 206 207]<br>此时最优值是：<br>   46.3648</p>
<p>最佳的方案是：<br>[7 15 21 28 42 53 60 78 96 105 109 118 127 137 150 166 176 190 203 214]<br>此时最优值是：<br>   93.4483</p>
<p>初始点：</p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20230106151805242.png" alt="image-20230106151805242"></p>
<p>优化方案：</p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20230106185939040.png" alt="image-20230106185939040"></p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line"><span class="comment">%% 模拟退火解决书店买书问题  % 466</span></span><br><span class="line">clear all; clc; close all;</span><br><span class="line"><span class="comment">% tic</span></span><br><span class="line">load points;</span><br><span class="line">points = <span class="built_in">sort</span>(points);</span><br><span class="line">rng(<span class="string">&#x27;shuffle&#x27;</span>)  <span class="comment">% 控制随机数的生成，否则每次打开matlab得到的结果都一样</span></span><br><span class="line">len = <span class="number">20</span>;</span><br><span class="line">map = [<span class="number">1</span>:len,<span class="number">1</span>:len];</span><br><span class="line"><span class="comment">% 这个数据文件里面保存了两个矩阵：M是每本书在每家店的价格; freight表示每家店的运费</span></span><br><span class="line"><span class="comment">% [s, b] = size(M);  % s是书店的数量，b是要购买的书的数量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% 参数初始化</span></span><br><span class="line">T0 = <span class="number">1000</span>;   <span class="comment">% 初始温度</span></span><br><span class="line">T = T0; <span class="comment">% 迭代中温度会发生改变，第一次迭代时温度就是T0</span></span><br><span class="line">maxgen = <span class="number">500</span>;  <span class="comment">% 最大迭代次数</span></span><br><span class="line">Lk = <span class="number">200</span>;  <span class="comment">% 每个温度下的迭代次数</span></span><br><span class="line">alfa = <span class="number">0.95</span>;  <span class="comment">% 温度衰减系数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%%  随机生成一个初始解</span></span><br><span class="line">A = int32(<span class="number">1</span>:<span class="built_in">length</span>(points));</span><br><span class="line">random_num = A(randperm(<span class="built_in">numel</span>(A),len));</span><br><span class="line">index0 = <span class="built_in">sort</span>(random_num);</span><br><span class="line">h0 = Copy_of_totalH(points, index0, len);</span><br><span class="line"></span><br><span class="line"><span class="comment">% way0 = randi([1, s],1,b); % 在1-s这些整数中随机抽取一个1*b的向量，表示这b本书分别在哪家书店购买</span></span><br><span class="line"><span class="comment">% money0 = calculate_money(way0,freight,M,b); % 调用我们自己写的calculate_money函数计算这个方案的花费</span></span><br><span class="line"><span class="built_in">disp</span>(<span class="string">&#x27;初始方案是：&#x27;</span>); <span class="built_in">disp</span>(mat2str(index0))</span><br><span class="line"><span class="built_in">disp</span>(<span class="string">&#x27;此时最优值是：&#x27;</span>); <span class="built_in">disp</span>(h0)</span><br><span class="line"><span class="comment">%% 定义一些保存中间过程的量，方便输出结果和画图</span></span><br><span class="line">min_money = h0;     <span class="comment">% 初始化找到的最佳的解对应的花费为money0</span></span><br><span class="line">MONEY = <span class="built_in">zeros</span>(maxgen,<span class="number">1</span>); <span class="comment">% 记录每一次外层循环结束后找到的min_money (方便画图）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% 模拟退火过程</span></span><br><span class="line"><span class="keyword">for</span> iter = <span class="number">1</span> : maxgen  <span class="comment">% 外循环, 我这里采用的是指定最大迭代次数</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : Lk  <span class="comment">%  内循环，在每个温度下开始迭代</span></span><br><span class="line">        index = index0;</span><br><span class="line">        x_num = index(randperm(<span class="built_in">numel</span>(index),<span class="number">1</span>));</span><br><span class="line">        x = <span class="built_in">find</span>(index == x_num);</span><br><span class="line">   </span><br><span class="line">        delta = <span class="number">0</span>;</span><br><span class="line">        delta = delta ...</span><br><span class="line">            - <span class="built_in">log</span>(<span class="number">2</span>* <span class="built_in">min</span>( <span class="built_in">mod</span>(points(index(map(x<span class="number">-1</span>+len)))-points(index(map(x<span class="number">-2</span>+len))) + <span class="number">360</span>, <span class="number">360</span>), <span class="built_in">mod</span>( points( index(x)) - points(index(map(x<span class="number">-1</span>+len))) + <span class="number">360</span>, <span class="number">360</span>) )) ...</span><br><span class="line">            - <span class="built_in">log</span>(<span class="number">2</span>* <span class="built_in">min</span>( <span class="built_in">mod</span>(points(index(x)) - points(index(map(x<span class="number">-1</span>+len))) + <span class="number">360</span> , <span class="number">360</span>) , <span class="built_in">mod</span>( points(index(map(x+<span class="number">1</span>))) - points(index(x)) + <span class="number">360</span> , <span class="number">360</span> ) )) ...</span><br><span class="line">            - <span class="built_in">log</span>(<span class="number">2</span>* <span class="built_in">min</span>( <span class="built_in">mod</span>(points(index(map(x+<span class="number">1</span>))) - points(index(x)) + <span class="number">360</span> , <span class="number">360</span>), <span class="built_in">mod</span>(points(index(map(x+<span class="number">2</span>))) - points(index(map(x+<span class="number">1</span>))) + <span class="number">360</span>, <span class="number">360</span> ) )) ...</span><br><span class="line">            + <span class="built_in">log</span>(<span class="number">2</span>* <span class="built_in">min</span>( <span class="built_in">mod</span>(points(index(map(x<span class="number">-1</span>+len))) - points(index(map(x<span class="number">-2</span>+len))) + <span class="number">360</span>, <span class="number">360</span>), <span class="built_in">mod</span>(points(index(map(x+<span class="number">1</span>))) - points(index(map(x<span class="number">-1</span>+len))) + <span class="number">360</span>, <span class="number">360</span>) )) ...</span><br><span class="line">            + <span class="built_in">log</span>(<span class="number">2</span>* <span class="built_in">min</span>( <span class="built_in">mod</span>(points(index(map(x+<span class="number">2</span>))) - points(index(map(x+<span class="number">1</span>))) + <span class="number">360</span>, <span class="number">360</span>), <span class="built_in">mod</span>(points(index(map(x+<span class="number">1</span>))) - points(index(map(x<span class="number">-1</span>+len))) + <span class="number">360</span>, <span class="number">360</span>) ));</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        shengxia = setxor(A, index);</span><br><span class="line">        y_num = shengxia(randperm(<span class="built_in">numel</span>(shengxia),<span class="number">1</span>));</span><br><span class="line">        index(x) = y_num;</span><br><span class="line">        index = <span class="built_in">sort</span>(index);</span><br><span class="line">        y = <span class="built_in">find</span>(index == y_num);</span><br><span class="line">        delta = delta ...</span><br><span class="line">            - <span class="built_in">log</span>(<span class="number">2</span>* <span class="built_in">min</span>( <span class="built_in">mod</span>(points(index(map(y<span class="number">-1</span>+len)))-points(index(map(y<span class="number">-2</span>+len))) + <span class="number">360</span>, <span class="number">360</span>), <span class="built_in">mod</span>( points( index(map(y+<span class="number">1</span>))) - points(index(map(y<span class="number">-1</span>+len))) + <span class="number">360</span>, <span class="number">360</span>) )) ...</span><br><span class="line">            - <span class="built_in">log</span>(<span class="number">2</span>* <span class="built_in">min</span>( <span class="built_in">mod</span>(points(index(map(y+<span class="number">1</span>))) - points(index(map(y<span class="number">-1</span>+len))) + <span class="number">360</span> , <span class="number">360</span>) , <span class="built_in">mod</span>( points(index(map(y+<span class="number">2</span>))) - points(index(map(y+<span class="number">1</span>))) + <span class="number">360</span> , <span class="number">360</span> ) )) ...</span><br><span class="line">            + <span class="built_in">log</span>(<span class="number">2</span>* <span class="built_in">min</span>( <span class="built_in">mod</span>(points(index(map(y<span class="number">-1</span> + len))) - points(index(map(y<span class="number">-2</span>+len))) + <span class="number">360</span> , <span class="number">360</span>), <span class="built_in">mod</span>(points(index(y)) - points(index(map(y<span class="number">-1</span> + len))) + <span class="number">360</span>, <span class="number">360</span> ) )) ...</span><br><span class="line">            + <span class="built_in">log</span>(<span class="number">2</span>* <span class="built_in">min</span>( <span class="built_in">mod</span>(points(index(y)) - points(index(map(y<span class="number">-1</span>+len))) + <span class="number">360</span>, <span class="number">360</span>), <span class="built_in">mod</span>(points(index(map(y+<span class="number">1</span>))) - points(index(y)) + <span class="number">360</span>, <span class="number">360</span>) )) ...</span><br><span class="line">            + <span class="built_in">log</span>(<span class="number">2</span>* <span class="built_in">min</span>( <span class="built_in">mod</span>(points(index(map(y+<span class="number">1</span>))) - points(index(y)) + <span class="number">360</span>, <span class="number">360</span>), <span class="built_in">mod</span>(points(index(map(y+<span class="number">2</span>))) - points(index(map(y+<span class="number">1</span>))) + <span class="number">360</span>, <span class="number">360</span>) ));</span><br><span class="line">        </span><br><span class="line">        index1 = index;  <span class="comment">% 调用我们自己写的gen_new_way函数生成新的方案</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> delta &gt; <span class="number">0</span>    <span class="comment">% 如果新方案的花费小于当前方案的花费</span></span><br><span class="line">            index0 = index1; <span class="comment">% 更新当前方案为新方案</span></span><br><span class="line">            h0 = h0 + delta;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line"><span class="comment">%             p = exp(-(money1 - money0)/T); % 根据Metropolis准则计算一个概率</span></span><br><span class="line">            p = <span class="built_in">exp</span>(delta/T); <span class="comment">% 根据Metropolis准则计算一个概率</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">rand</span>(<span class="number">1</span>) &lt; p   <span class="comment">% 生成一个随机数和这个概率比较，如果该随机数小于这个概率</span></span><br><span class="line">                index0 = index1; <span class="comment">% 更新当前方案为新方案</span></span><br><span class="line">                h0 = h0 + delta;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="comment">% 判断是否要更新找到的最佳的解</span></span><br><span class="line">        <span class="keyword">if</span> h0 &gt; min_money  <span class="comment">% 如果当前解更好，则对其进行更新</span></span><br><span class="line">            min_money = h0;  <span class="comment">% 更新最大的花费</span></span><br><span class="line">            best_way = index1;  <span class="comment">% 更新找到的最佳方案</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    MONEY(iter) = min_money; <span class="comment">% 保存本轮外循环结束后找到的最小花费</span></span><br><span class="line">    T = alfa*T;   <span class="comment">% 温度下降</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">disp</span>(<span class="string">&#x27;最佳的方案是：&#x27;</span>); <span class="built_in">disp</span>(mat2str(best_way))</span><br><span class="line"><span class="built_in">disp</span>(<span class="string">&#x27;此时最优值是：&#x27;</span>); <span class="built_in">disp</span>(min_money)</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 画出每次迭代后找到的最佳方案的图形</span></span><br><span class="line"><span class="built_in">figure</span></span><br><span class="line"><span class="built_in">plot</span>(<span class="number">1</span>:maxgen,MONEY,<span class="string">&#x27;b-&#x27;</span>);</span><br><span class="line">xlabel(<span class="string">&#x27;迭代次数&#x27;</span>);</span><br><span class="line">ylabel(<span class="string">&#x27;最小花费&#x27;</span>);</span><br><span class="line"><span class="comment">% toc</span></span><br></pre></td></tr></table></figure>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20230106185725474.png" alt="image-20230106185725474"></p>
<p>用py验证一下</p>
<p>改变一下distance的定义，由于要循环</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_h</span>(<span class="params">x, k=<span class="number">1</span>, norm=<span class="string">&#x27;max&#x27;</span>, min_dist=<span class="number">0.</span></span>):</span></span><br><span class="line">    n, d = x.shape</span><br><span class="line"></span><br><span class="line">    p = <span class="number">2</span></span><br><span class="line">    log_c_d = (d/<span class="number">2.</span>) * log(np.pi) - log(gamma(d/<span class="number">2.</span> + <span class="number">1</span>))</span><br><span class="line">    print(log_c_d)</span><br><span class="line"></span><br><span class="line">    kdtree = cKDTree(x)</span><br><span class="line"></span><br><span class="line">    distances, _ = kdtree.query(x, k + <span class="number">1</span>, eps=<span class="number">0</span>, p=p)</span><br><span class="line">    distances = distances[:, -<span class="number">1</span>]</span><br><span class="line">    distances[<span class="number">0</span>] = <span class="built_in">min</span>(x[<span class="number">1</span>] - x[<span class="number">0</span>], x[<span class="number">0</span>] + <span class="number">360</span> - x[-<span class="number">1</span>])</span><br><span class="line">    distances[-<span class="number">1</span>] = <span class="built_in">min</span>(x[-<span class="number">1</span>] - x[-<span class="number">2</span>], x[<span class="number">0</span>] + <span class="number">360</span> - x[-<span class="number">1</span>])</span><br><span class="line">    print(<span class="string">&quot;distance&quot;</span>, distances)</span><br><span class="line">    <span class="comment"># enforce non-zero distances</span></span><br><span class="line">    distances[distances &lt; min_dist] = min_dist</span><br><span class="line">    <span class="comment"># where did the 2 come from? radius -&gt; diameter</span></span><br><span class="line">    sum_log_dist = np.<span class="built_in">sum</span>(log(<span class="number">2</span>*distances))</span><br><span class="line">    h = sum_log_dist</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> h</span><br></pre></td></tr></table></figure>
<p>初始方案是：<br>[26 27 36 38 52 64 69 77 86 102 132 149 150 154 156 157 173 187 199 201]<br>此时最优值是：<br>   26.7911</p>
<p>最佳的方案是：<br>[5 12 19 27 44 57 87 103 110 120 126 132 138 147 152 165 172 188 198 210]<br>此时最优值是：<br>   70.6790</p>
<p>历时 3.124118 秒。</p>
<p>迭代计算只需要计算那改变的6个点，试试直接计算h0 看时间会多慢</p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line"><span class="comment">%% 模拟退火解决书店买书问题  % 466</span></span><br><span class="line">clear all; clc; close all;</span><br><span class="line">tic</span><br><span class="line">load points;</span><br><span class="line">points = <span class="built_in">sort</span>(points);</span><br><span class="line">rng(<span class="string">&#x27;shuffle&#x27;</span>)  <span class="comment">% 控制随机数的生成，否则每次打开matlab得到的结果都一样</span></span><br><span class="line">len = <span class="number">20</span>;</span><br><span class="line">map = [<span class="number">1</span>:len,<span class="number">1</span>:len];</span><br><span class="line"><span class="comment">% 这个数据文件里面保存了两个矩阵：M是每本书在每家店的价格; freight表示每家店的运费</span></span><br><span class="line"><span class="comment">% [s, b] = size(M);  % s是书店的数量，b是要购买的书的数量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% 参数初始化</span></span><br><span class="line">T0 = <span class="number">1000</span>;   <span class="comment">% 初始温度</span></span><br><span class="line">T = T0; <span class="comment">% 迭代中温度会发生改变，第一次迭代时温度就是T0</span></span><br><span class="line">maxgen = <span class="number">500</span>;  <span class="comment">% 最大迭代次数</span></span><br><span class="line">Lk = <span class="number">200</span>;  <span class="comment">% 每个温度下的迭代次数</span></span><br><span class="line">alfa = <span class="number">0.95</span>;  <span class="comment">% 温度衰减系数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%%  随机生成一个初始解</span></span><br><span class="line">A = int32(<span class="number">1</span>:<span class="built_in">length</span>(points));</span><br><span class="line">random_num = A(randperm(<span class="built_in">numel</span>(A),len));</span><br><span class="line">index0 = <span class="built_in">sort</span>(random_num);</span><br><span class="line">h0 = Copy_of_totalH(points, index0, len);</span><br><span class="line"></span><br><span class="line"><span class="comment">% way0 = randi([1, s],1,b); % 在1-s这些整数中随机抽取一个1*b的向量，表示这b本书分别在哪家书店购买</span></span><br><span class="line"><span class="comment">% money0 = calculate_money(way0,freight,M,b); % 调用我们自己写的calculate_money函数计算这个方案的花费</span></span><br><span class="line"><span class="built_in">disp</span>(<span class="string">&#x27;初始方案是：&#x27;</span>); <span class="built_in">disp</span>(mat2str(index0))</span><br><span class="line"><span class="built_in">disp</span>(<span class="string">&#x27;此时最优值是：&#x27;</span>); <span class="built_in">disp</span>(h0)</span><br><span class="line"><span class="comment">%% 定义一些保存中间过程的量，方便输出结果和画图</span></span><br><span class="line">min_money = h0;     <span class="comment">% 初始化找到的最佳的解对应的花费为money0</span></span><br><span class="line">MONEY = <span class="built_in">zeros</span>(maxgen,<span class="number">1</span>); <span class="comment">% 记录每一次外层循环结束后找到的min_money (方便画图）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% 模拟退火过程</span></span><br><span class="line"><span class="keyword">for</span> iter = <span class="number">1</span> : maxgen  <span class="comment">% 外循环, 我这里采用的是指定最大迭代次数</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : Lk  <span class="comment">%  内循环，在每个温度下开始迭代</span></span><br><span class="line">        index = index0;</span><br><span class="line">        x_num = index(randperm(<span class="built_in">numel</span>(index),<span class="number">1</span>));</span><br><span class="line">        x = <span class="built_in">find</span>(index == x_num);</span><br><span class="line">        shengxia = setxor(A, index);</span><br><span class="line">        y_num = shengxia(randperm(<span class="built_in">numel</span>(shengxia),<span class="number">1</span>));</span><br><span class="line">        index(x) = y_num;</span><br><span class="line">        index = <span class="built_in">sort</span>(index);      </span><br><span class="line">        index1 = index;  <span class="comment">% 调用我们自己写的gen_new_way函数生成新的方案</span></span><br><span class="line"></span><br><span class="line">        h1 = Copy_of_totalH(points, index1, len);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> h1 &gt; h0    <span class="comment">% 如果新方案的花费小于当前方案的花费</span></span><br><span class="line">            index0 = index1; <span class="comment">% 更新当前方案为新方案</span></span><br><span class="line">            h0 = h1;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line"><span class="comment">%             p = exp(-(money1 - money0)/T); % 根据Metropolis准则计算一个概率</span></span><br><span class="line">            p = <span class="built_in">exp</span>((h1 - h0)/T); <span class="comment">% 根据Metropolis准则计算一个概率</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">rand</span>(<span class="number">1</span>) &lt; p   <span class="comment">% 生成一个随机数和这个概率比较，如果该随机数小于这个概率</span></span><br><span class="line">                index0 = index1; <span class="comment">% 更新当前方案为新方案</span></span><br><span class="line">                h0 = h1;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="comment">% 判断是否要更新找到的最佳的解</span></span><br><span class="line">        <span class="keyword">if</span> h0 &gt; min_money  <span class="comment">% 如果当前解更好，则对其进行更新</span></span><br><span class="line">            min_money = h0;  <span class="comment">% 更新最大的花费</span></span><br><span class="line">            best_way = index1;  <span class="comment">% 更新找到的最佳方案</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    MONEY(iter) = min_money; <span class="comment">% 保存本轮外循环结束后找到的最小花费</span></span><br><span class="line">    T = alfa*T;   <span class="comment">% 温度下降</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">disp</span>(<span class="string">&#x27;最佳的方案是：&#x27;</span>); <span class="built_in">disp</span>(mat2str(best_way))</span><br><span class="line"><span class="built_in">disp</span>(<span class="string">&#x27;此时最优值是：&#x27;</span>); <span class="built_in">disp</span>(min_money)</span><br><span class="line"></span><br><span class="line"><span class="comment">%% 画出每次迭代后找到的最佳方案的图形</span></span><br><span class="line"><span class="built_in">figure</span></span><br><span class="line"><span class="built_in">plot</span>(<span class="number">1</span>:maxgen,MONEY,<span class="string">&#x27;b-&#x27;</span>);</span><br><span class="line">xlabel(<span class="string">&#x27;迭代次数&#x27;</span>);</span><br><span class="line">ylabel(<span class="string">&#x27;最小花费&#x27;</span>);</span><br><span class="line">toc</span><br></pre></td></tr></table></figure>
<p>历时 3.305654 秒。</p>
<p>但耗时也不多</p>
<p>但增加迭代次数</p>
<p>maxgen = 1000;  % 最大迭代次数<br>Lk = 1000;  % 每个温度下的迭代次数</p>
<p>初始方案是：<br>[10 26 35 62 76 77 91 120 129 130 141 151 163 166 176 180 182 208 209 214]<br>此时最优值是：<br>   43.8157</p>
<p>最佳的方案是：<br>[10 17 23 40 53 67 90 105 110 120 126 131 138 148 153 166 172 188 200 214]<br>此时最优值是：<br>   70.7798</p>
<p><strong>历时 31.648947 秒。</strong></p>
<p>而只用6个点的数据</p>
<p><strong>历时 29.961089 秒。</strong></p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20230106194131081.png" alt="image-20230106194131081"></p>
<p>708个点选50个点也只需要4s</p>
<p>初始方案是：<br>[7 32 33 83 98 103 106 113 139 152 161 164 171 201 220 229 235 257 280 298 299 319 332 349 352 355 360 365 373 393 401 407 434 450 455 470 479 506 508 531 540 548 565 566 589 603 640 679 689 707]<br>此时最优值是：<br>   73.5312</p>
<p>最佳的方案是：<br>[12 26 39 52 64 74 82 93 119 132 151 166 184 208 230 255 271 285 296 305 320 329 342 350 359 367 379 389 406 427 439 455 466 474 486 492 503 519 530 544 561 577 598 615 630 639 651 672 686 708]<br>此时最优值是：<br>  130.3724</p>
<p>历时 4.013932 秒。</p>
<p><img src="rto3hzle5.hd-bkt.clouddn.com/image-20230106195352809.png" alt="image-20230106195352809"></p>
<p>绝对完美的20个点是怎么样的</p>
<p>K-L estimator: 71.67038</p>
<p>50个点则是</p>
<p>K-L estimator: 133.36141</p>
<hr>
<p>研究一下归一化</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">tsuiwade</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://tsuiwade.github.io/2023/01/06/blog70-study5/">https://tsuiwade.github.io/2023/01/06/blog70-study5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://tsuiwade.github.io" target="_blank">TsuiWade's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%A7%91%E7%A0%94/">科研</a></div><div class="post_share"><div class="social-share" data-image="/rto3hzle5.hd-bkt.clouddn.com/image-20230106151805242.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">不给糖就捣蛋</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></button></div><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/04/24/blog71-studyover/"><img class="prev-cover" src="/rto3hzle5.hd-bkt.clouddn.com/image-20230424195853639.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">冲毕业结束</div></div></a></div><div class="next-post pull-right"><a href="/2022/12/19/blog69-study4/"><img class="next-cover" src="/rto3hzle5.hd-bkt.clouddn.com/image-20221212201741568.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">冲毕业第五周记录</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/11/22/blog66-study1/" title="冲毕业第一周记录"><img class="cover" src="/rto3hzle5.hd-bkt.clouddn.com/image-20221122152053959.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-22</div><div class="title">冲毕业第一周记录</div></div></a></div><div><a href="/2022/12/19/blog69-study4/" title="冲毕业第五周记录"><img class="cover" src="/rto3hzle5.hd-bkt.clouddn.com/image-20221212201741568.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-19</div><div class="title">冲毕业第五周记录</div></div></a></div><div><a href="/2022/12/06/blog67-study2/" title="冲毕业第二、三周记录"><img class="cover" src="/rto3hzle5.hd-bkt.clouddn.com/image-20221126191150684.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-06</div><div class="title">冲毕业第二、三周记录</div></div></a></div><div><a href="/2022/12/10/blog68-study3/" title="冲毕业第四周记录"><img class="cover" src="/rto3hzle5.hd-bkt.clouddn.com/image-20221210165212635.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-10</div><div class="title">冲毕业第四周记录</div></div></a></div><div><a href="/2023/04/24/blog71-studyover/" title="冲毕业结束"><img class="cover" src="/rto3hzle5.hd-bkt.clouddn.com/image-20230424195853639.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-24</div><div class="title">冲毕业结束</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/avatar.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">tsuiwade</div><div class="author-info__description">记录技术生活的点点滴滴</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">70</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">23</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/tsuiwade"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/tsuiwade" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:478451541@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/381957255" target="_blank" title="bilibili"><i class="iconfont  icon-bilibili"></i></a><a class="social-icon" href="/img/alipay.jpg" target="_blank" title="alipay"><i class="fab  fa-alipay"></i></a><a class="social-icon" href="/img/wechat.jpg" target="_blank" title="wechat"><i class="fab  fa-weixin"></i></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=478451541" target="_blank" title="qq"><i class="fab  fa-qq"></i></a><a class="social-icon" href="https://blog.csdn.net/" target="_blank" title="CSDN"><i class="iconfont  icon-csdn3"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=321642197" target="_blank" title="wangyiyun"><i class="iconfont  icon-wangyiyunyinyuemusic1193417easyiconnet"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">clc;clear;close all;
x &#x3D; [1,2,3,4,5,6,7,8,9,10];
pd2 &#x3D; makedist(&amp;#x27;Uniform&amp;#x27;,&amp;#x27;lower&amp;#x27;,0,&amp;#x27;upper&amp;#x27;,10); % Uniform distribution with a &#x3D; -2 and b &#x3D; 2
t &#x3D; 0:.01:10;
cdf2 &#x3D; cdf(pd2, t);
h1 &#x3D; cdfplot(x);
hold on
plot(t,cdf2,&amp;#x27;k:&amp;#x27;,&amp;#x27;LineWidth&amp;#x27;,2);
xlabel(&amp;#x27;样本数据&amp;#x27;);
ylabel(&amp;#x27;累积分布函数F(x)&amp;#x27;);
</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/04/24/blog71-studyover/" title="冲毕业结束"><img src="/rto3hzle5.hd-bkt.clouddn.com/image-20230424195853639.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="冲毕业结束"/></a><div class="content"><a class="title" href="/2023/04/24/blog71-studyover/" title="冲毕业结束">冲毕业结束</a><time datetime="2023-04-24T20:08:32.000Z" title="发表于 2023-04-24 20:08:32">2023-04-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/06/blog70-study5/" title="冲毕业第六七八周记录"><img src="/rto3hzle5.hd-bkt.clouddn.com/image-20230106151805242.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="冲毕业第六七八周记录"/></a><div class="content"><a class="title" href="/2023/01/06/blog70-study5/" title="冲毕业第六七八周记录">冲毕业第六七八周记录</a><time datetime="2023-01-06T21:16:25.000Z" title="发表于 2023-01-06 21:16:25">2023-01-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/19/blog69-study4/" title="冲毕业第五周记录"><img src="/rto3hzle5.hd-bkt.clouddn.com/image-20221212201741568.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="冲毕业第五周记录"/></a><div class="content"><a class="title" href="/2022/12/19/blog69-study4/" title="冲毕业第五周记录">冲毕业第五周记录</a><time datetime="2022-12-19T16:29:26.000Z" title="发表于 2022-12-19 16:29:26">2022-12-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/10/blog68-study3/" title="冲毕业第四周记录"><img src="/rto3hzle5.hd-bkt.clouddn.com/image-20221210165212635.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="冲毕业第四周记录"/></a><div class="content"><a class="title" href="/2022/12/10/blog68-study3/" title="冲毕业第四周记录">冲毕业第四周记录</a><time datetime="2022-12-10T16:57:34.000Z" title="发表于 2022-12-10 16:57:34">2022-12-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/06/blog67-study2/" title="冲毕业第二、三周记录"><img src="/rto3hzle5.hd-bkt.clouddn.com/image-20221126191150684.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="冲毕业第二、三周记录"/></a><div class="content"><a class="title" href="/2022/12/06/blog67-study2/" title="冲毕业第二、三周记录">冲毕业第二、三周记录</a><time datetime="2022-12-06T16:30:34.000Z" title="发表于 2022-12-06 16:30:34">2022-12-06</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/rto3hzle5.hd-bkt.clouddn.com/image-20230106151805242.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By tsuiwade</div><div class="footer_custom_text"><p><a style="margin-inline:5px"target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为 Hexo" alt="HEXO"></a><a style="margin-inline:5px"target="_blank" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用 Butterfly" alt="Butterfly"></a><a style="margin-inline:5px"target="_blank" href="https://www.jsdelivr.com/"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="本站使用 Jsdelivr 为静态资源提供CDN加速" alt="Jsdelivr"></a><a style="margin-inline:5px"target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由 GitHub 托管" alt="GitHub"></a><a style="margin-inline:5px"target="_blank"href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" alt="img" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div><div id="workboard"><script async="async" src="/js/runtime.js"></script></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'mjS6lvGtY7MvAlxolqz8OdMn-gzGzoHsz',
      appKey: 'QakpY3QuhiOscnuh50tI450M',
      placeholder: '留下你的足迹吧~~',
      avatar: 'monsterid',
      meta: 'nick'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/js/hideMobileSidebar.js"></script><script defer src="https://cdn.jsdelivr.net/gh/graingert/wow@1.3.0/dist/wow.min.js"></script><script data-pjax src="/js/myjs.js"></script><script data-pjax src="/js/githubcalendar.js"></script><script data-pjax src="/js/giteecalendar.js"></script><script defer data-pjax src="/js/wow_init.js"></script><script src="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/js/mouse_snow.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@latest/source/js/issues.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>function history_calendar_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>那年今日</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>';
                console.log('已挂载history_calendar')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='all'|| 'all' ==='all')){

            history_calendar_injector_config()
        } </script><script data-pjax  src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script data-pjax>function electric_clock_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img id="card-clock-loading" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-clock/clock/images/weather/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading" class="entered loading"></div></div></div></div></div>';
                console.log('已挂载electric_clock')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='all'|| 'all' ==='all')){

            electric_clock_injector_config()
        } </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax  src="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.js"></script>
  <script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://python-github-calendar-api.vercel.app/api?tsuiwade";
            var git_color =['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'];
            var git_user ="tsuiwade";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log('已挂载github calendar')
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end --></body></html>