<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>冲毕业第四周记录 | TsuiWade's blog</title><meta name="keywords" content="科研"><meta name="author" content="tsuiwade"><meta name="copyright" content="tsuiwade"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="在novas库的帮助下，顺利由原始hipparcosJ991.25星表转为 标准的J2000，再转到视赤道坐标系下，再转到地平坐标系下">
<meta property="og:type" content="article">
<meta property="og:title" content="冲毕业第四周记录">
<meta property="og:url" content="https://tsuiwade.github.io/2022/12/10/blog68-study3/index.html">
<meta property="og:site_name" content="TsuiWade&#39;s blog">
<meta property="og:description" content="在novas库的帮助下，顺利由原始hipparcosJ991.25星表转为 标准的J2000，再转到视赤道坐标系下，再转到地平坐标系下">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221210165212635.png">
<meta property="article:published_time" content="2022-12-10T16:57:34.000Z">
<meta property="article:modified_time" content="2022-12-10T16:57:34.000Z">
<meta property="article:author" content="tsuiwade">
<meta property="article:tag" content="科研">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221210165212635.png"><link rel="shortcut icon" href="/img/me.png"><link rel="canonical" href="https://tsuiwade.github.io/2022/12/10/blog68-study3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-12-10 16:57:34'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/css/iconfont.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_2390943_bv078yuunhu.css"><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css"  media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="TsuiWade's blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/1a27de723e1cb04e5acd82cbf4146166_31ebbe760ba45b872b1b8f6c19eb6246.gif" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">23</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fas fa-chart-bar"></i><span> 统计</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221210165212635.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">TsuiWade's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fas fa-chart-bar"></i><span> 统计</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">冲毕业第四周记录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-12-10T16:57:34.000Z" title="发表于 2022-12-10 16:57:34">2022-12-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-12-10T16:57:34.000Z" title="更新于 2022-12-10 16:57:34">2022-12-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%A7%91%E7%A0%94/">科研</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>51分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221210165212635.png" alt="image-20221210165212635"></p>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221210165212635.png" alt="image-20221210165212635"></p>
<p>很奇怪j2000不是一个固定的值吗（其实自己也不是很清楚</p>
<p>但Stellarium软件的J2000值在变</p>
<p>问了天文同学也不太清楚， 直接在Stellarium的github 讨论区问作者。</p>
<p>作者回答</p>
<p>Please do not use Stellarium as source or reference for own work. It has its own errors.</p>
<p>That said, to compare, set Stellarium to J1991.25 (to set proper motion自行), and observe the J2000 1月1日12时 儒略日 coordinates. At least disable aberration and probably even nutation章动. Or observe from the center of the Sun.</p>
<p>当我从设置观测点为太阳时，设置儒略日 <code>完美对上!</code></p>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221206205114703.png" alt="image-20221206205114703"></p>
<p>得到的J2000</p>
<p>与</p>
<p><a target="_blank" rel="noopener" href="https://github.com/gmiller123456/hip2000">https://github.com/gmiller123456/hip2000</a></p>
<p>项目中 使用NOVAS（Naval Observatory Vector Astrometry Subroutines）库的transform_hip功能</p>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221206205154919.png" alt="image-20221206205154919"></p>
<p>一致</p>
<hr>
<p>hipparcos源文件中的北落师门 hip = 113368 </p>
<p>ra = 6.011119421 rad</p>
<p>ra = 344.411772972423023020 度 </p>
<p>ra = 22.960784864828202245 h</p>
<p>ra = h: 22 m: 57 s: 38.825513381528082846</p>
<p>dec = -29.621836820143990110</p>
<p>dec =  h: -29 m: 37 s: 18.612552518364395837</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PI acos(-1);</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> ra = <span class="number">6.011119421</span>;</span><br><span class="line">    <span class="keyword">double</span> dec = <span class="number">-0.516998583</span>;</span><br><span class="line">    <span class="keyword">double</span> decd = dec * <span class="number">180</span> / PI;</span><br><span class="line">    <span class="keyword">double</span> rad = ra * <span class="number">180</span> / PI;</span><br><span class="line">    <span class="keyword">double</span> rah = rad / <span class="number">15</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; fixed &lt;&lt; setprecision(<span class="number">18</span>) &lt;&lt; rad &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; rah &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; h: &quot;</span> &lt;&lt; (<span class="keyword">int</span>)rah &lt;&lt; <span class="string">&quot; m: &quot;</span> &lt;&lt; <span class="keyword">int</span>((rah - <span class="keyword">int</span>(rah)) * <span class="number">60</span>) &lt;&lt; <span class="string">&quot; s: &quot;</span> &lt;&lt; <span class="number">60</span> * ((rah - <span class="keyword">int</span>(rah)) * <span class="number">60</span> - <span class="keyword">int</span>((rah - <span class="keyword">int</span>(rah)) * <span class="number">60</span>)) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; decd &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; h: &quot;</span> &lt;&lt; (<span class="keyword">int</span>)decd &lt;&lt; <span class="string">&quot; m: &quot;</span> &lt;&lt; <span class="built_in">abs</span>(<span class="keyword">int</span>((decd - <span class="keyword">int</span>(decd)) * <span class="number">60</span>)) &lt;&lt; <span class="string">&quot; s: &quot;</span> &lt;&lt; <span class="built_in">abs</span>(<span class="number">60</span> * ((decd - <span class="keyword">int</span>(decd)) * <span class="number">60</span> - <span class="keyword">int</span>((decd - <span class="keyword">int</span>(decd)) * <span class="number">60</span>))) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>研究一下novas库如何实现将j1991.25到J2000的</p>
<p><a target="_blank" rel="noopener" href="https://github.com/brandon-rhodes/python-novas">https://github.com/brandon-rhodes/python-novas</a></p>
<p>看说明先装novas库，可惜不能支持windows</p>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221206215016569.png" alt="image-20221206215016569"></p>
<p>这是已易于使用的Hipparcos目录的更改版本。原始目录具有1991.25的Equinox的RA/DEC坐标。在这里，我使用NOVA函数“ transform_hip”将坐标转换为J2000。</p>
<hr>
<p>在海军天文台novas.c中有一个函数transform_hip，作用是将 依巴谷原始星表中的J1991.25纪元的数据转换为FK5形式的数据，专用于依巴谷星表，</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/********transform_hip */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transform_hip</span> <span class="params">(cat_entry *hipparcos, cat_entry *fk5)</span></span></span><br><span class="line"><span class="function"><span class="comment">/*</span></span></span><br><span class="line"><span class="function"><span class="comment">------------------------------------------------------------------------</span></span></span><br><span class="line"><span class="function"><span class="comment"></span></span></span><br><span class="line"><span class="function"><span class="comment">   PURPOSE:</span></span></span><br><span class="line"><span class="function"><span class="comment">      To convert Hipparcos data at epoch J1991.25 to epoch J2000.0 and</span></span></span><br><span class="line"><span class="function"><span class="comment">      FK5-style units.  To be used only for Hipparcos or Tycho stars </span></span></span><br><span class="line"><span class="function"><span class="comment">      with linear space motion.</span></span></span><br><span class="line"><span class="function"><span class="comment"></span></span></span><br><span class="line"><span class="function"><span class="comment">   INPUT</span></span></span><br><span class="line"><span class="function"><span class="comment">   ARGUMENTS:</span></span></span><br><span class="line"><span class="function"><span class="comment">      *hipparcos (struct cat_entry)</span></span></span><br><span class="line"><span class="function"><span class="comment">         An entry from the Hipparcos catalog, at epoch J1991.25, with </span></span></span><br><span class="line"><span class="function"><span class="comment">         all members having Hipparcos catalog units.  See Note 1</span></span></span><br><span class="line"><span class="function"><span class="comment">         below (struct defined in novas.h).</span></span></span><br><span class="line"><span class="function"><span class="comment"></span></span></span><br><span class="line"><span class="function"><span class="comment">   OUTPUT</span></span></span><br><span class="line"><span class="function"><span class="comment">   ARGUMENTS:</span></span></span><br><span class="line"><span class="function"><span class="comment">      *fk5 (struct cat_entry)</span></span></span><br><span class="line"><span class="function"><span class="comment">         The transformed input entry, at epoch J2000.0, with all </span></span></span><br><span class="line"><span class="function"><span class="comment">         members having FK5 catalog units.  See Note 2 below (struct </span></span></span><br><span class="line"><span class="function"><span class="comment">         defined in novas.h).</span></span></span><br><span class="line"><span class="function"><span class="comment"></span></span></span><br><span class="line"><span class="function"><span class="comment"></span></span></span><br><span class="line"><span class="function"><span class="comment"></span></span></span><br><span class="line"><span class="function"><span class="comment">   NOTES:</span></span></span><br><span class="line"><span class="function"><span class="comment">      1. Hipparcos epoch and units:</span></span></span><br><span class="line"><span class="function"><span class="comment">         Epoch: J1991.25</span></span></span><br><span class="line"><span class="function"><span class="comment">         Right ascension (RA): degrees</span></span></span><br><span class="line"><span class="function"><span class="comment">         Declination (Dec): degrees</span></span></span><br><span class="line"><span class="function"><span class="comment">         Proper motion in RA * cos (Dec): milliarcseconds per year</span></span></span><br><span class="line"><span class="function"><span class="comment">         Proper motion in Dec: milliarcseconds per year</span></span></span><br><span class="line"><span class="function"><span class="comment">         Parallax: milliarcseconds</span></span></span><br><span class="line"><span class="function"><span class="comment">         Radial velocity: kilometers per second (not in catalog)</span></span></span><br><span class="line"><span class="function"><span class="comment">      2. FK5 epoch and units:</span></span></span><br><span class="line"><span class="function"><span class="comment">         Epoch: J2000.0</span></span></span><br><span class="line"><span class="function"><span class="comment">         Right ascension: hours</span></span></span><br><span class="line"><span class="function"><span class="comment">         Declination: degrees</span></span></span><br><span class="line"><span class="function"><span class="comment">         Proper motion in RA: seconds of time per Julian century</span></span></span><br><span class="line"><span class="function"><span class="comment">         Proper motion in Dec: arcseconds per Julian century</span></span></span><br><span class="line"><span class="function"><span class="comment">         Parallax: arcseconds</span></span></span><br><span class="line"><span class="function"><span class="comment">         Radial velocity: kilometers per second</span></span></span><br><span class="line"><span class="function"><span class="comment">      3. This function based on subroutine &#x27;gethip&#x27; from NOVAS Fortran.</span></span></span><br><span class="line"><span class="function"><span class="comment"></span></span></span><br><span class="line"><span class="function"><span class="comment">------------------------------------------------------------------------</span></span></span><br><span class="line"><span class="function"><span class="comment">*/</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">double</span> epoch_hip = <span class="number">2448349.0625</span>;</span><br><span class="line">   <span class="keyword">double</span> epoch_fk5 = <span class="number">2451545.0000</span>;</span><br><span class="line"></span><br><span class="line">   cat_entry scratch;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   The &quot;scratch&quot; catalog entry contains data with FK5-like units at </span></span><br><span class="line"><span class="comment">   epoch J1991.25.  Copy the catalog entry quantities that don&#x27;t </span></span><br><span class="line"><span class="comment">   change from the Hipparcos catalog entry to the &quot;scratch&quot; entry.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in">strcpy</span> (scratch.starname, hipparcos-&gt;starname);</span><br><span class="line">   scratch.starnumber = hipparcos-&gt;starnumber;</span><br><span class="line">   scratch.dec = hipparcos-&gt;dec;</span><br><span class="line">   scratch.radialvelocity = hipparcos-&gt;radialvelocity;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">strcpy</span> (scratch.catalog, <span class="string">&quot;SCR&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   Convert Hipparcos units to FK5-like units; insert transformed</span></span><br><span class="line"><span class="comment">   quantities into the &quot;scratch&quot; catalog entry.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">   scratch.ra = hipparcos-&gt;ra / <span class="number">15.0</span>;</span><br><span class="line">   scratch.promora = hipparcos-&gt;promora / (<span class="number">150.0</span> * </span><br><span class="line">      <span class="built_in">cos</span> (hipparcos-&gt;dec * DEG2RAD));</span><br><span class="line">   scratch.promodec = hipparcos-&gt;promodec / <span class="number">10.0</span>;</span><br><span class="line">   scratch.parallax = hipparcos-&gt;parallax / <span class="number">1000.0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   Change the epoch of the Hipparcos data from J1991.25 to J2000.0.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">   transform_cat (<span class="number">1</span>,epoch_hip,&amp;scratch,epoch_fk5,<span class="string">&quot;FK5&quot;</span>, fk5);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>user guide中写道：Radial velocity (hipparcos-&gt;radialvelocity) is not given in the Hipparcos catalog. If a value is not known, set hipparcos-&gt;radialvelocity = 0.0. The radial velocity is important for only a small number of nearby, high proper motion stars.</p>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221207150407348.png" alt="image-20221207150407348"></p>
<h2 id=""><a href="#" class="headerlink" title=""></a><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> TWOPI = <span class="number">6.28318530717958647692</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> DEG2RAD = <span class="number">0.017453292519943296</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> RAD2DEG = <span class="number">57.295779513082321</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> RAD2SEC = <span class="number">206264.806247096355</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> epoch_hip = <span class="number">2448349.0625</span>; <span class="comment">// J1991.25</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> epoch_fk5 = <span class="number">2451545.0000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ARGUMENTS:</span></span><br><span class="line"><span class="comment">    in :</span></span><br><span class="line"><span class="comment">        hip_ra (rad)</span></span><br><span class="line"><span class="comment">        hip_dec (rad)</span></span><br><span class="line"><span class="comment">        hip_promora (mas/yr)</span></span><br><span class="line"><span class="comment">        hip_promodec (mas/yr)</span></span><br><span class="line"><span class="comment">        hip_parallax (mas)</span></span><br><span class="line"><span class="comment">    out :</span></span><br><span class="line"><span class="comment">        fk5_ra(h)</span></span><br><span class="line"><span class="comment">        fk5_dec(degree)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">convert</span><span class="params">(<span class="keyword">double</span> hip_ra, <span class="keyword">double</span> hip_dec, <span class="keyword">double</span> hip_promora, <span class="keyword">double</span> hip_promodec, <span class="keyword">double</span> hip_parallax, <span class="keyword">double</span> &amp;fk5_ra, <span class="keyword">double</span> &amp;fk5_dec)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    hip_ra = hip_ra * RAD2DEG / <span class="number">15.0</span>;</span><br><span class="line">    hip_promora = hip_promora / (<span class="number">150.0</span> * <span class="built_in">cos</span>(hip_dec));</span><br><span class="line">    hip_dec *= RAD2DEG;</span><br><span class="line">    hip_promodec /= <span class="number">10.0</span>;</span><br><span class="line">    hip_parallax /= <span class="number">1000.0</span>;</span><br><span class="line">    <span class="keyword">if</span> (hip_parallax &lt;= <span class="number">0.0</span>)</span><br><span class="line">        hip_parallax = <span class="number">1.0e-7</span>;</span><br><span class="line">    <span class="keyword">double</span> dist = RAD2SEC / hip_parallax;</span><br><span class="line">    <span class="keyword">double</span> r = hip_ra * <span class="number">54000.0</span> / RAD2SEC;</span><br><span class="line">    <span class="keyword">double</span> d = hip_dec * <span class="number">3600.0</span> / RAD2SEC;</span><br><span class="line">    <span class="keyword">double</span> cra, sra, cdc, sdc, pos1[<span class="number">3</span>], term1, pmr, pmd, vel1[<span class="number">3</span>], pos2[<span class="number">3</span>], xyproj;</span><br><span class="line">    cra = <span class="built_in">cos</span>(r);</span><br><span class="line">    sra = <span class="built_in">sin</span>(r);</span><br><span class="line">    cdc = <span class="built_in">cos</span>(d);</span><br><span class="line">    sdc = <span class="built_in">sin</span>(d);</span><br><span class="line">    pos1[<span class="number">0</span>] = dist * cdc * cra;</span><br><span class="line">    pos1[<span class="number">1</span>] = dist * cdc * sra;</span><br><span class="line">    pos1[<span class="number">2</span>] = dist * sdc;</span><br><span class="line">    term1 = hip_parallax * <span class="number">36525.0</span>;</span><br><span class="line">    pmr = hip_promora * <span class="number">15.0</span> * cdc / term1;</span><br><span class="line">    pmd = hip_promodec / term1;</span><br><span class="line">    vel1[<span class="number">0</span>] = -pmr * sra - pmd * sdc * cra;</span><br><span class="line">    vel1[<span class="number">1</span>] = pmr * cra - pmd * sdc * sra;</span><br><span class="line">    vel1[<span class="number">2</span>] = pmd * cdc;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        pos2[j] = pos1[j] + vel1[j] * (epoch_fk5 - epoch_hip);</span><br><span class="line">    &#125;</span><br><span class="line">    xyproj = <span class="built_in">sqrt</span>(pos2[<span class="number">0</span>] * pos2[<span class="number">0</span>] + pos2[<span class="number">1</span>] * pos2[<span class="number">1</span>]);</span><br><span class="line">    r = <span class="built_in">atan2</span>(pos2[<span class="number">1</span>], pos2[<span class="number">0</span>]);</span><br><span class="line">    d = <span class="built_in">atan2</span>(pos2[<span class="number">2</span>], xyproj);</span><br><span class="line">    fk5_ra = r * RAD2SEC / <span class="number">54000.0</span>;</span><br><span class="line">    fk5_dec = d * RAD2SEC / <span class="number">3600.0</span>;</span><br><span class="line">    <span class="keyword">if</span> (fk5_ra &lt; <span class="number">0.0</span>)</span><br><span class="line">        fk5_ra += <span class="number">24.0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> hip_ra = <span class="number">6.011119421</span>;</span><br><span class="line">    <span class="keyword">double</span> hip_dec = <span class="number">-0.516998583</span>;</span><br><span class="line">    <span class="keyword">double</span> hip_promora = <span class="number">328.95</span>;</span><br><span class="line">    <span class="keyword">double</span> hip_promodec = <span class="number">-164.67</span>;</span><br><span class="line">    <span class="keyword">double</span> hip_parallax = <span class="number">129.81</span>;</span><br><span class="line">    <span class="keyword">double</span> fk5_ra, fk5_dec;</span><br><span class="line"></span><br><span class="line">    convert(hip_ra, hip_dec, hip_promora, hip_promodec, hip_parallax, fk5_ra, fk5_dec);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> rah = fk5_ra;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; ra: &quot;</span> &lt;&lt; fk5_ra;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; rah: &quot;</span> &lt;&lt; <span class="keyword">int</span>(rah) &lt;&lt; <span class="string">&quot; ram: &quot;</span> &lt;&lt; <span class="keyword">int</span>((rah - <span class="keyword">int</span>(rah)) * <span class="number">60</span>) &lt;&lt; <span class="string">&quot; ras: &quot;</span> &lt;&lt; <span class="number">60</span> * ((rah - <span class="keyword">int</span>(rah)) * <span class="number">60</span> - <span class="keyword">int</span>((rah - <span class="keyword">int</span>(rah)) * <span class="number">60</span>)) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; fk5_dec &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">double</span> dech = fk5_dec;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; dech &quot;</span> &lt;&lt; <span class="keyword">int</span>(dech) &lt;&lt; <span class="string">&quot; ram: &quot;</span> &lt;&lt; <span class="keyword">int</span>((dech - <span class="keyword">int</span>(dech)) * <span class="number">60</span>) &lt;&lt; <span class="string">&quot; ras: &quot;</span> &lt;&lt; <span class="number">60</span> * ((dech - <span class="keyword">int</span>(dech)) * <span class="number">60</span> - <span class="keyword">int</span>((dech - <span class="keyword">int</span>(dech)) * <span class="number">60</span>)) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2><p>研究一下j2000转 <code>视赤道坐标</code> 的转换</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">short</span> <span class="keyword">int</span> <span class="title">app_star</span> <span class="params">(<span class="keyword">double</span> tjd, body *earth, cat_entry *star, <span class="keyword">double</span> *ra, <span class="keyword">double</span> *dec)</span></span></span><br><span class="line"><span class="function"><span class="comment">/*   PURPOSE:</span></span></span><br><span class="line"><span class="function"><span class="comment">      Computes the apparent place of a star at date &#x27;tjd&#x27;, given its mean place, proper motion, parallax, and radial velocity for J2000.0.</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">short</span> <span class="keyword">int</span> <span class="title">get_earth</span> <span class="params">(<span class="keyword">double</span> tjd, body *earth,</span></span></span><br><span class="line"><span class="function"><span class="params">                     <span class="keyword">double</span> *tdb,</span></span></span><br><span class="line"><span class="function"><span class="params">                     <span class="keyword">double</span> *bary_earthp, <span class="keyword">double</span> *bary_earthv,</span></span></span><br><span class="line"><span class="function"><span class="params">                     <span class="keyword">double</span> *helio_earthp, <span class="keyword">double</span> *helio_earthv)</span></span></span><br><span class="line"><span class="function">    <span class="comment">//  Obtains the barycentric &amp; heliocentric positions and velocities of the Earth from the solar system ephemeris. 从太阳系星历表中获取地球的重心和日心位置和速度。</span></span></span><br></pre></td></tr></table></figure>
<p>在novas第一个函数中</p>
<p>TDB：质心力学时 和 tjd：在novas中就是儒略日；</p>
<p>TT：Terrestrial Time (TT) 地球时</p>
<p>TDT：Terrestrial Dynamical Time </p>
<p>UTC：协调世界时</p>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221207192519170.png" alt="image-20221207192519170"></p>
<p>Barycentric动力学时间（TDB，来自法国温度动态Barycentrique）是一个相对论坐标时间尺度，旨在在计算轨道，小型小行星，彗星和彗星和彗星和彗星和彗星，彗星和彗星，彗星和彗星，彗星和彗星，彗星和彗星，彗星和天文学的轨道和天文学时，供天文使用作为时间标准[1]太阳系中的星际航天器。</p>
<hr>
<p>c++时间转换</p>
<p>得到UTC时间 <a target="_blank" rel="noopener" href="https://www.runoob.com/cplusplus/cpp-date-time.html">https://www.runoob.com/cplusplus/cpp-date-time.html</a></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">time_t</span> now = time(<span class="number">0</span>);</span><br><span class="line">tm *utc = gmtime(&amp;now);</span><br><span class="line"></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; fixed &lt;&lt; setprecision(<span class="number">10</span>) &lt;&lt; julian_date(<span class="number">1900</span> + utc-&gt;tm_year, <span class="number">1</span> + utc-&gt;tm_mon, utc-&gt;tm_mday, utc-&gt;tm_hour + utc-&gt;tm_min / <span class="number">60.0</span> + utc-&gt;tm_sec / <span class="number">3600.0</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>计算儒略日</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">julian_date</span><span class="params">(<span class="keyword">short</span> <span class="keyword">int</span> year, <span class="keyword">short</span> <span class="keyword">int</span> month, <span class="keyword">short</span> <span class="keyword">int</span> day, <span class="keyword">double</span> hour)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> jd12h = (<span class="keyword">long</span>)day - <span class="number">32075L</span> + <span class="number">1461L</span> * ((<span class="keyword">long</span>)year + <span class="number">4800L</span> + ((<span class="keyword">long</span>)month - <span class="number">14L</span>) / <span class="number">12L</span>) / <span class="number">4L</span> + <span class="number">367L</span> * ((<span class="keyword">long</span>)month - <span class="number">2L</span> - ((<span class="keyword">long</span>)month - <span class="number">14L</span>) / <span class="number">12L</span> * <span class="number">12L</span>) / <span class="number">12L</span> - <span class="number">3L</span> * (((<span class="keyword">long</span>)year + <span class="number">4900L</span> + ((<span class="keyword">long</span>)month - <span class="number">14L</span>) / <span class="number">12L</span>) / <span class="number">100L</span>) / <span class="number">4L</span>;</span><br><span class="line">    <span class="keyword">double</span> tjd = (<span class="keyword">double</span>)jd12h - <span class="number">0.5</span> + hour / <span class="number">24.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (tjd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/%CE%94T_(timekeeping">https://en.wikipedia.org/wiki/%CE%94T_(timekeeping</a>)</p>
<p>为了求 The difference between terrestrial dynamical time system 1 time, and universal time.</p>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221208114456687.png" alt="image-20221208114456687"></p>
<p>设置为deltat = 67.</p>
<p>但事实上该值设置完之后反而和软件中的值不一致，因此设为0；</p>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221208202842675.png" alt="image-20221208202842675"></p>
<p>方位角和两个软件误差2’’和0.2’’，高度角相差7’’和0.8’’ ，非常准，验证成功！</p>
<p>关键函数讲解</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">equ2hor</span><span class="params">(<span class="keyword">double</span> tjd, <span class="keyword">double</span> deltat, <span class="keyword">double</span> x, <span class="keyword">double</span> y, site_info *location, <span class="keyword">double</span> ra, <span class="keyword">double</span> dec, <span class="keyword">short</span> <span class="keyword">int</span> ref_option, <span class="keyword">double</span> *zd, <span class="keyword">double</span> *az, <span class="keyword">double</span> *rar, <span class="keyword">double</span> *decr)</span></span></span><br><span class="line"><span class="function"><span class="comment">// tjd 为儒略日</span></span></span><br><span class="line"><span class="function"><span class="comment">// deltat应该为 TT (or TDT)-UT1 大约70  但设置了值之后反而和软件中的值不一样 故设为0</span></span></span><br><span class="line"><span class="function"><span class="comment">// x y 设为0</span></span></span><br><span class="line"><span class="function"><span class="comment">// site_info loc = &#123;32.08, 118.8, 10, 10, 1013&#125;; 温度和高度都设为10，压强毫巴和百帕一致</span></span></span><br><span class="line"><span class="function"><span class="comment">// ref_option设为0 no refraction 不考虑蒙气差</span></span></span><br><span class="line"><span class="function"><span class="comment">// </span></span></span><br></pre></td></tr></table></figure>
<hr>
<p>现在研究一下从hipparcos星表 根据星等 处理为J1991.25</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">user_cols = [<span class="string">&#x27;hip&#x27;</span>, <span class="string">&#x27;a2&#x27;</span>, <span class="string">&#x27;a3&#x27;</span>, <span class="string">&#x27;a4&#x27;</span>, <span class="string">&#x27;ra&#x27;</span>, <span class="string">&#x27;dec&#x27;</span>, <span class="string">&#x27;plx&#x27;</span>, <span class="string">&#x27;pmra&#x27;</span>, <span class="string">&#x27;pmdec&#x27;</span>, <span class="string">&#x27;era&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;ede&#x27;</span>, <span class="string">&#x27;eplx&#x27;</span>, <span class="string">&#x27;epmra&#x27;</span>, <span class="string">&#x27;epmde&#x27;</span>, <span class="string">&#x27;ntr&#x27;</span>, <span class="string">&#x27;f2&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, <span class="string">&#x27;var&#x27;</span>, <span class="string">&#x27;ic&#x27;</span>, <span class="string">&#x27;hpmag&#x27;</span>]</span><br><span class="line">mag = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6.5</span>]</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> mag:</span><br><span class="line">    df = pd.read_table(<span class="string">&quot;hip2.dat&quot;</span>, sep=<span class="string">&#x27;\s+&#x27;</span>, header=<span class="literal">None</span>,</span><br><span class="line">                       engine=<span class="string">&#x27;python&#x27;</span>, index_col=<span class="number">0</span>, usecols=<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">20</span>)), names=user_cols)</span><br><span class="line"></span><br><span class="line">    df1 = df[df[<span class="string">&#x27;hpmag&#x27;</span>] &lt;= m]</span><br><span class="line"></span><br><span class="line">    tmp = df1[<span class="string">&#x27;ra&#x27;</span>] * <span class="number">180</span> / math.pi</span><br><span class="line">    df1.insert(df1.shape[<span class="number">1</span>], <span class="string">&#x27;ra_d&#x27;</span>, tmp)</span><br><span class="line"></span><br><span class="line">    tmp = df1[<span class="string">&#x27;dec&#x27;</span>] * <span class="number">180</span> / math.pi</span><br><span class="line">    df1.insert(df1.shape[<span class="number">1</span>], <span class="string">&#x27;dec_d&#x27;</span>, tmp)</span><br><span class="line">    newdf = df1[[<span class="string">&#x27;ra_d&#x27;</span>, <span class="string">&#x27;dec_d&#x27;</span>, <span class="string">&#x27;pmra&#x27;</span>, <span class="string">&#x27;pmdec&#x27;</span>, <span class="string">&#x27;plx&#x27;</span>, <span class="string">&#x27;hpmag&#x27;</span>]]</span><br><span class="line">    newdf.to_csv(<span class="string">&#x27;J1991_25_&#x27;</span>+<span class="built_in">str</span>(m)+<span class="string">&#x27;.csv&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221209181128304.png" alt="image-20221209181128304"></p>
<p>单位分别为：hip、度、度、mas/year、mas/year、mas、星等</p>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221209181146712.png" alt="image-20221209181146712"></p>
<p>hip_main.dat文件中有118322个星</p>
<p>有两种星表</p>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221209162226229.png" alt="image-20221209162226229"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line">user_cols = [<span class="string">&#x27;hip&#x27;</span>, <span class="string">&#x27;a2&#x27;</span>, <span class="string">&#x27;a3&#x27;</span>, <span class="string">&#x27;a4&#x27;</span>,  <span class="string">&#x27;a5&#x27;</span>,   <span class="string">&#x27;ra&#x27;</span>, <span class="string">&#x27;a6&#x27;</span>]</span><br><span class="line">df = pd.read_table(<span class="string">&quot;hip_main.dat&quot;</span>, delimiter=<span class="string">&#x27;|&#x27;</span>, header=<span class="literal">None</span>,usecols=<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">7</span>)),names=user_cols)</span><br><span class="line"></span><br><span class="line">df[<span class="string">&quot;ra&quot;</span>] = [<span class="built_in">float</span>(<span class="built_in">str</span>(i).replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;0&quot;</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> df[<span class="string">&quot;ra&quot;</span>]]</span><br><span class="line">df[<span class="string">&#x27;ra&#x27;</span>].astype(<span class="built_in">float</span>)</span><br><span class="line"></span><br><span class="line">df1 = df[df[<span class="string">&#x27;ra&#x27;</span>] &lt;= <span class="number">6.5</span>]</span><br></pre></td></tr></table></figure>
<p>针对的是Magnitude in Johnson V 而hip2只有Hpmag  Hipparcos magnitude</p>
<p>前为hip1  后为hip2</p>
<p>&lt;= 6.5 有8875个星  7982</p>
<p>&lt; 6.5  8790个星  7982</p>
<p>&lt;= 6.0 5045个星    4559</p>
<p>&lt; 6.0 4996个星   4559</p>
<p>&lt;= 5.0 1628个星  1471</p>
<p>&lt; 5.0 1609个星  1471</p>
<p>&lt;= 4.0 520个星  480</p>
<p>&lt; 4.0 517个星   480 </p>
<p>&lt;= 3.0 178个星  165</p>
<p>&lt; 3.0 173个星   165</p>
<p>&lt;= 2.0 50个星  46 </p>
<p>&lt; 2.0 50个星   46 </p>
<p>&lt;= 1.0 16个星  15</p>
<p>&lt; 1.0 16个星  15</p>
<p>一是  <a target="_blank" rel="noopener" href="https://heasarc.gsfc.nasa.gov/W3Browse/all/hipparcos.html">https://heasarc.gsfc.nasa.gov/W3Browse/all/hipparcos.html</a></p>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221209162308287.png" alt="image-20221209162308287"></p>
<p>二是 <a target="_blank" rel="noopener" href="http://vizier.cds.unistra.fr/viz-bin/VizieR-3?-source=I/311/hip2">http://vizier.cds.unistra.fr/viz-bin/VizieR-3?-source=I/311/hip2</a></p>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221209162337713.png" alt="image-20221209162337713"></p>
<p>2007年发布了由Hipparcos任务产生的天文数据的新降低，声称几乎全明星的精度比HP = 8的幅度更明亮，要比原始目录中的幅度更好，最高为4。该目录被称为Hipparcos-2目录。</p>
<hr>
<p>J1991.25 转 J2000</p>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221210161025540.png" alt="image-20221210161025540"></p>
<p><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221210161117925.png" alt="image-20221210161117925"></p>
<p>经过验证 没问题，</p>
<p>除了6种星等 只需要0.2s</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BARYC 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HELIOC 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> KMAU = <span class="number">1.49597870e+8</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> TWOPI = <span class="number">6.28318530717958647692</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> RAD2SEC = <span class="number">206264.806247096355</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> DEG2RAD = <span class="number">0.017453292519943296</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> epoch_hip = <span class="number">2448349.0625</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> epoch_fk5 = <span class="number">2451545.0000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> starnumber;</span><br><span class="line">    <span class="keyword">double</span> ra;</span><br><span class="line">    <span class="keyword">double</span> dec;</span><br><span class="line">    <span class="keyword">double</span> promora;</span><br><span class="line">    <span class="keyword">double</span> promodec;</span><br><span class="line">    <span class="keyword">double</span> parallax;</span><br><span class="line">    <span class="keyword">double</span> radialvelocity = <span class="number">0</span>;</span><br><span class="line">&#125; cat_entry;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transform_cat</span><span class="params">(cat_entry *incat, cat_entry *newcat)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> paralx, dist, r, d, cra, sra, cdc, sdc, pos1[<span class="number">3</span>], term1, pmr, pmd, rvl, vel1[<span class="number">3</span>], pos2[<span class="number">3</span>], vel2[<span class="number">3</span>], xyproj;</span><br><span class="line"></span><br><span class="line">    paralx = incat-&gt;parallax;</span><br><span class="line">    <span class="keyword">if</span> (paralx &lt;= <span class="number">0.0</span>)</span><br><span class="line">        paralx = <span class="number">1.0e-7</span>;</span><br><span class="line"></span><br><span class="line">    dist = RAD2SEC / paralx;</span><br><span class="line">    r = incat-&gt;ra * <span class="number">54000.0</span> / RAD2SEC;</span><br><span class="line">    d = incat-&gt;dec * <span class="number">3600.0</span> / RAD2SEC;</span><br><span class="line">    cra = <span class="built_in">cos</span>(r);</span><br><span class="line">    sra = <span class="built_in">sin</span>(r);</span><br><span class="line">    cdc = <span class="built_in">cos</span>(d);</span><br><span class="line">    sdc = <span class="built_in">sin</span>(d);</span><br><span class="line">    pos1[<span class="number">0</span>] = dist * cdc * cra;</span><br><span class="line">    pos1[<span class="number">1</span>] = dist * cdc * sra;</span><br><span class="line">    pos1[<span class="number">2</span>] = dist * sdc;</span><br><span class="line"></span><br><span class="line">    term1 = paralx * <span class="number">36525.0</span>;</span><br><span class="line">    pmr = incat-&gt;promora * <span class="number">15.0</span> * cdc / term1;</span><br><span class="line">    pmd = incat-&gt;promodec / term1;</span><br><span class="line"></span><br><span class="line">    vel1[<span class="number">0</span>] = -pmr * sra - pmd * sdc * cra;</span><br><span class="line">    vel1[<span class="number">1</span>] = pmr * cra - pmd * sdc * sra;</span><br><span class="line">    vel1[<span class="number">2</span>] = pmd * cdc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">short</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        pos2[j] = pos1[j] + vel1[j] * (epoch_fk5 - epoch_hip);</span><br><span class="line">        vel2[j] = vel1[j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    xyproj = <span class="built_in">sqrt</span>(pos2[<span class="number">0</span>] * pos2[<span class="number">0</span>] + pos2[<span class="number">1</span>] * pos2[<span class="number">1</span>]);</span><br><span class="line">    r = <span class="built_in">atan2</span>(pos2[<span class="number">1</span>], pos2[<span class="number">0</span>]);</span><br><span class="line">    d = <span class="built_in">atan2</span>(pos2[<span class="number">2</span>], xyproj);</span><br><span class="line">    newcat-&gt;ra = r * RAD2SEC / <span class="number">54000.0</span>;</span><br><span class="line">    newcat-&gt;dec = d * RAD2SEC / <span class="number">3600.0</span>;</span><br><span class="line">    <span class="keyword">if</span> (newcat-&gt;ra &lt; <span class="number">0.0</span>)</span><br><span class="line">        newcat-&gt;ra += <span class="number">24.0</span>;</span><br><span class="line"></span><br><span class="line">    dist = <span class="built_in">sqrt</span>(pos2[<span class="number">0</span>] * pos2[<span class="number">0</span>] + pos2[<span class="number">1</span>] * pos2[<span class="number">1</span>] +</span><br><span class="line">                pos2[<span class="number">2</span>] * pos2[<span class="number">2</span>]);</span><br><span class="line">    paralx = RAD2SEC / dist;</span><br><span class="line">    newcat-&gt;parallax = paralx;</span><br><span class="line"></span><br><span class="line">    cra = <span class="built_in">cos</span>(r);</span><br><span class="line">    sra = <span class="built_in">sin</span>(r);</span><br><span class="line">    cdc = <span class="built_in">cos</span>(d);</span><br><span class="line">    sdc = <span class="built_in">sin</span>(d);</span><br><span class="line">    pmr = -vel2[<span class="number">0</span>] * sra + vel2[<span class="number">1</span>] * cra;</span><br><span class="line">    pmd = -vel2[<span class="number">0</span>] * cra * sdc - vel2[<span class="number">1</span>] * sra * sdc + vel2[<span class="number">2</span>] * cdc;</span><br><span class="line">    rvl = vel2[<span class="number">0</span>] * cra * cdc + vel2[<span class="number">1</span>] * sra * cdc + vel2[<span class="number">2</span>] * sdc;</span><br><span class="line"></span><br><span class="line">    newcat-&gt;promora = pmr * paralx * <span class="number">36525.0</span> / (<span class="number">15.0</span> * cdc);</span><br><span class="line">    newcat-&gt;promodec = pmd * paralx * <span class="number">36525.0</span>;</span><br><span class="line">    newcat-&gt;radialvelocity = rvl * KMAU / <span class="number">86400.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (newcat-&gt;parallax &lt;= <span class="number">1.01e-7</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        newcat-&gt;parallax = <span class="number">0.0</span>;</span><br><span class="line">        newcat-&gt;radialvelocity = incat-&gt;radialvelocity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    newcat-&gt;starnumber = incat-&gt;starnumber;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transform_hip</span><span class="params">(cat_entry *hipparcos, cat_entry *fk5)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cat_entry scratch;</span><br><span class="line">    scratch.starnumber = hipparcos-&gt;starnumber;</span><br><span class="line">    scratch.dec = hipparcos-&gt;dec;</span><br><span class="line">    scratch.radialvelocity = hipparcos-&gt;radialvelocity;</span><br><span class="line"></span><br><span class="line">    scratch.ra = hipparcos-&gt;ra / <span class="number">15.0</span>;</span><br><span class="line">    scratch.promora = hipparcos-&gt;promora / (<span class="number">150.0</span> *</span><br><span class="line">                                            <span class="built_in">cos</span>(hipparcos-&gt;dec * DEG2RAD));</span><br><span class="line">    scratch.promodec = hipparcos-&gt;promodec / <span class="number">10.0</span>;</span><br><span class="line">    scratch.parallax = hipparcos-&gt;parallax / <span class="number">1000.0</span>;</span><br><span class="line"></span><br><span class="line">    transform_cat(&amp;scratch, fk5);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">clock_t</span> start, end; <span class="comment">// 定义clock_t变量</span></span><br><span class="line"></span><br><span class="line">    start = clock(); <span class="comment">// 开始时间</span></span><br><span class="line"></span><br><span class="line">    cat_entry hip, fk5;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; files = &#123;<span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;6&quot;</span>, <span class="string">&quot;6.5&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; files.size(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">ifstream <span class="title">inFile</span><span class="params">(<span class="string">&quot;C:\\Users\\hp\\Downloads\\hip2.dat\\J1991_25_&quot;</span> + files[i] + <span class="string">&quot;.csv&quot;</span>)</span></span>;</span><br><span class="line">        <span class="function">ofstream <span class="title">outFile</span><span class="params">(<span class="string">&quot;C:\\Users\\hp\\Downloads\\hip2.dat\\J2000_&quot;</span> + files[i] + <span class="string">&quot;.csv&quot;</span>)</span></span>;</span><br><span class="line">        <span class="built_in">string</span> lineStr;</span><br><span class="line">        <span class="keyword">double</span> hgmag;</span><br><span class="line">        getline(inFile, lineStr); <span class="comment">// 跳过列名，第一行不做处理</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (getline(inFile, lineStr))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// cout &lt;&lt; lineStr &lt;&lt; endl;</span></span><br><span class="line">            <span class="comment">// 存成二维表结构</span></span><br><span class="line">            <span class="function"><span class="built_in">stringstream</span> <span class="title">ss</span><span class="params">(lineStr)</span></span>;</span><br><span class="line">            <span class="built_in">string</span> str;</span><br><span class="line">            <span class="comment">// 按照逗号分隔</span></span><br><span class="line">            getline(ss, str, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">            hip.starnumber = stod(str);</span><br><span class="line">            getline(ss, str, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">            hip.ra = stod(str);</span><br><span class="line">            getline(ss, str, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">            hip.dec = stod(str);</span><br><span class="line">            getline(ss, str, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">            hip.promora = stod(str);</span><br><span class="line">            getline(ss, str, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">            hip.promodec = stod(str);</span><br><span class="line">            getline(ss, str, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">            hip.parallax = stod(str);</span><br><span class="line">            getline(ss, str, <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">            hgmag = stod(str);</span><br><span class="line"></span><br><span class="line">            transform_hip(&amp;hip, &amp;fk5);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// cout &lt;&lt; &quot; hip &quot; &lt;&lt; hip.starnumber &lt;&lt; &quot; ra &quot; &lt;&lt; hip.ra &lt;&lt; &quot; dec &quot; &lt;&lt; hip.dec &lt;&lt; &quot; promora: &quot; &lt;&lt; hip.promora &lt;&lt; &quot; promodec: &quot; &lt;&lt; hip.promodec &lt;&lt; &quot; para &quot; &lt;&lt; hip.parallax &lt;&lt; endl;</span></span><br><span class="line">            outFile &lt;&lt; fk5.starnumber &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; fk5.ra &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; fk5.dec &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; fk5.promora &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; fk5.promodec &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; fk5.parallax &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; hgmag &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    end = clock();                                                            <span class="comment">// 结束时间</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;time = &quot;</span> &lt;&lt; <span class="keyword">double</span>(end - start) / CLOCKS_PER_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 输出时间（单位：ｓ）</span></span><br><span class="line">    system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>最终代码（novas有阉割）为</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BARYC 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HELIOC 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> T0 = <span class="number">2451545.00000000</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> KMAU = <span class="number">1.49597870e+8</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> MAU = <span class="number">1.49597870e+11</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> C = <span class="number">173.14463348</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> GS = <span class="number">1.32712438e+20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> TWOPI = <span class="number">6.28318530717958647692</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> RAD2SEC = <span class="number">206264.806247096355</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> DEG2RAD = <span class="number">0.017453292519943296</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> RAD2DEG = <span class="number">57.295779513082321</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> epoch_hip = <span class="number">2448349.0625</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> epoch_fk5 = <span class="number">2451545.0000</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">double</span> PSI_COR = <span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">double</span> EPS_COR = <span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">short</span> <span class="keyword">int</span> FN0 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> starnumber;</span><br><span class="line">    <span class="keyword">double</span> ra;</span><br><span class="line">    <span class="keyword">double</span> dec;</span><br><span class="line">    <span class="keyword">double</span> promora;</span><br><span class="line">    <span class="keyword">double</span> promodec;</span><br><span class="line">    <span class="keyword">double</span> parallax;</span><br><span class="line">    <span class="keyword">double</span> radialvelocity;</span><br><span class="line">&#125; cat_entry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">double</span> latitude;</span><br><span class="line">    <span class="keyword">double</span> longitude;</span><br><span class="line">&#125; site_info;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">short</span> <span class="keyword">int</span> <span class="title">vector2radec</span><span class="params">(<span class="keyword">double</span> *pos, <span class="keyword">double</span> *ra, <span class="keyword">double</span> *dec)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> xyproj;</span><br><span class="line"></span><br><span class="line">    xyproj = <span class="built_in">sqrt</span>(<span class="built_in">pow</span>(pos[<span class="number">0</span>], <span class="number">2.0</span>) + <span class="built_in">pow</span>(pos[<span class="number">1</span>], <span class="number">2.0</span>));</span><br><span class="line">    <span class="keyword">if</span> ((xyproj == <span class="number">0.0</span>) &amp;&amp; (pos[<span class="number">2</span>] == <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        *ra = <span class="number">0.0</span>;</span><br><span class="line">        *dec = <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (xyproj == <span class="number">0.0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        *ra = <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">if</span> (pos[<span class="number">2</span>] &lt; <span class="number">0.0</span>)</span><br><span class="line">            *dec = <span class="number">-90.0</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            *dec = <span class="number">90.0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        *ra = <span class="built_in">atan2</span>(pos[<span class="number">1</span>], pos[<span class="number">0</span>]) * RAD2SEC / <span class="number">54000.0</span>;</span><br><span class="line">        *dec = <span class="built_in">atan2</span>(pos[<span class="number">2</span>], xyproj) * RAD2SEC / <span class="number">3600.0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (*ra &lt; <span class="number">0.0</span>)</span><br><span class="line">            *ra += <span class="number">24.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fund_args</span><span class="params">(<span class="keyword">double</span> t, <span class="keyword">double</span> a[<span class="number">5</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    a[<span class="number">0</span>] = <span class="number">2.3555483935439407</span> + t * (<span class="number">8328.691422883896</span> + t * (<span class="number">1.517951635553957e-4</span> + <span class="number">3.1028075591010306e-7</span> * t));</span><br><span class="line">    a[<span class="number">1</span>] = <span class="number">6.240035939326023</span> + t * (<span class="number">628.3019560241842</span> + t * (<span class="number">-2.7973749400020225e-6</span> - <span class="number">5.817764173314431e-8</span> * t));</span><br><span class="line">    a[<span class="number">2</span>] = <span class="number">1.6279019339719611</span> + t * (<span class="number">8433.466158318453</span> + t * (<span class="number">-6.427174970469119e-5</span> + <span class="number">5.332950492204896e-8</span> * t));</span><br><span class="line">    a[<span class="number">3</span>] = <span class="number">5.198469513579922</span> + t * (<span class="number">7771.377146170642</span> + t * (<span class="number">-3.340851076525812e-5</span> + <span class="number">9.211459941081184e-8</span> * t));</span><br><span class="line">    a[<span class="number">4</span>] = <span class="number">2.1824386243609943</span> + t * (<span class="number">-33.75704593375351</span> + t * (<span class="number">3.614285992671591e-5</span> + <span class="number">3.878509448876288e-8</span> * t));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        a[i] = <span class="built_in">fmod</span>(a[i], TWOPI);</span><br><span class="line">        <span class="keyword">if</span> (a[i] &lt; <span class="number">0.0</span>)</span><br><span class="line">            a[i] += TWOPI;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">short</span> <span class="keyword">int</span> <span class="title">nutation_angles</span><span class="params">(<span class="keyword">double</span> t, <span class="keyword">double</span> *longnutation, <span class="keyword">double</span> *obliqnutation)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> clng[<span class="number">106</span>] = &#123;<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>,</span><br><span class="line">                        <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>,</span><br><span class="line">                        <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>,</span><br><span class="line">                        <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>,</span><br><span class="line">                        <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">2.0</span>,</span><br><span class="line">                        <span class="number">2.0</span>, <span class="number">2.0</span>, <span class="number">2.0</span>, <span class="number">2.0</span>, <span class="number">-2.0</span>, <span class="number">2.0</span>, <span class="number">2.0</span>,</span><br><span class="line">                        <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">-3.0</span>, <span class="number">-3.0</span>, <span class="number">3.0</span>, <span class="number">-3.0</span>, <span class="number">3.0</span>,</span><br><span class="line">                        <span class="number">-3.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">4.0</span>, <span class="number">-4.0</span>, <span class="number">-4.0</span>, <span class="number">4.0</span>,</span><br><span class="line">                        <span class="number">-4.0</span>, <span class="number">5.0</span>, <span class="number">5.0</span>, <span class="number">5.0</span>, <span class="number">-5.0</span>, <span class="number">6.0</span>, <span class="number">6.0</span>,</span><br><span class="line">                        <span class="number">6.0</span>, <span class="number">-6.0</span>, <span class="number">6.0</span>, <span class="number">-7.0</span>, <span class="number">7.0</span>, <span class="number">7.0</span>, <span class="number">-7.0</span>,</span><br><span class="line">                        <span class="number">-8.0</span>, <span class="number">10.0</span>, <span class="number">11.0</span>, <span class="number">12.0</span>, <span class="number">-13.0</span>, <span class="number">-15.0</span>, <span class="number">-16.0</span>,</span><br><span class="line">                        <span class="number">-16.0</span>, <span class="number">17.0</span>, <span class="number">-21.0</span>, <span class="number">-22.0</span>, <span class="number">26.0</span>, <span class="number">29.0</span>, <span class="number">29.0</span>,</span><br><span class="line">                        <span class="number">-31.0</span>, <span class="number">-38.0</span>, <span class="number">-46.0</span>, <span class="number">48.0</span>, <span class="number">-51.0</span>, <span class="number">58.0</span>, <span class="number">59.0</span>,</span><br><span class="line">                        <span class="number">63.0</span>, <span class="number">63.0</span>, <span class="number">-123.0</span>, <span class="number">129.0</span>, <span class="number">-158.0</span>, <span class="number">-217.0</span>, <span class="number">-301.0</span>,</span><br><span class="line">                        <span class="number">-386.0</span>, <span class="number">-517.0</span>, <span class="number">712.0</span>, <span class="number">1426.0</span>, <span class="number">2062.0</span>, <span class="number">-2274.0</span>,</span><br><span class="line">                        <span class="number">-13187.0</span>, <span class="number">-171996.0</span>&#125;,</span><br><span class="line">           clngx[<span class="number">14</span>] = &#123;<span class="number">0.1</span>, <span class="number">-0.1</span>, <span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0.2</span>, <span class="number">-0.2</span>, <span class="number">-0.4</span>, <span class="number">0.5</span>, <span class="number">1.2</span>,</span><br><span class="line">                        <span class="number">-1.6</span>, <span class="number">-3.4</span>, <span class="number">-174.2</span>&#125;,</span><br><span class="line">           cobl[<span class="number">64</span>] = &#123;<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>,</span><br><span class="line">                       <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>,</span><br><span class="line">                       <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>, <span class="number">-1.0</span>,</span><br><span class="line">                       <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>, <span class="number">-2.0</span>,</span><br><span class="line">                       <span class="number">-2.0</span>, <span class="number">-2.0</span>, <span class="number">3.0</span>, <span class="number">3.0</span>, <span class="number">-3.0</span>, <span class="number">3.0</span>,</span><br><span class="line">                       <span class="number">3.0</span>, <span class="number">-3.0</span>, <span class="number">3.0</span>, <span class="number">3.0</span>, <span class="number">-3.0</span>, <span class="number">3.0</span>,</span><br><span class="line">                       <span class="number">3.0</span>, <span class="number">5.0</span>, <span class="number">6.0</span>, <span class="number">7.0</span>, <span class="number">-7.0</span>, <span class="number">7.0</span>,</span><br><span class="line">                       <span class="number">-8.0</span>, <span class="number">9.0</span>, <span class="number">-10.0</span>, <span class="number">-12.0</span>, <span class="number">13.0</span>, <span class="number">16.0</span>,</span><br><span class="line">                       <span class="number">-24.0</span>, <span class="number">26.0</span>, <span class="number">27.0</span>, <span class="number">32.0</span>, <span class="number">-33.0</span>, <span class="number">-53.0</span>,</span><br><span class="line">                       <span class="number">54.0</span>, <span class="number">-70.0</span>, <span class="number">-95.0</span>, <span class="number">129.0</span>, <span class="number">200.0</span>, <span class="number">224.0</span>,</span><br><span class="line">                       <span class="number">-895.0</span>, <span class="number">977.0</span>, <span class="number">5736.0</span>, <span class="number">92025.0</span>&#125;,</span><br><span class="line">           coblx[<span class="number">8</span>] = &#123;<span class="number">-0.1</span>, <span class="number">-0.1</span>, <span class="number">0.3</span>, <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">-0.6</span>, <span class="number">-3.1</span>, <span class="number">8.9</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> i, ii, i1, i2, iop;</span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> nav1[<span class="number">10</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>&#125;,</span><br><span class="line">              nav2[<span class="number">10</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>&#125;,</span><br><span class="line">              nav[<span class="number">183</span>] = &#123;<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">17</span>, <span class="number">8</span>,</span><br><span class="line">                          <span class="number">1</span>, <span class="number">18</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">17</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="number">1</span>,</span><br><span class="line">                          <span class="number">2</span>, <span class="number">21</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">29</span>, <span class="number">1</span>, <span class="number">21</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">29</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">9</span>,</span><br><span class="line">                          <span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>,</span><br><span class="line">                          <span class="number">1</span>, <span class="number">14</span>, <span class="number">44</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">45</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">44</span>, <span class="number">2</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">36</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">45</span>,</span><br><span class="line">                          <span class="number">1</span>, <span class="number">37</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">45</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">44</span>, <span class="number">2</span>, <span class="number">53</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">40</span>, <span class="number">3</span>,</span><br><span class="line">                          <span class="number">2</span>, <span class="number">17</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">64</span>, <span class="number">1</span>, <span class="number">39</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">27</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">1</span>, <span class="number">21</span>, <span class="number">47</span>,</span><br><span class="line">                          <span class="number">2</span>, <span class="number">44</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">44</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">45</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">46</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">67</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">74</span>,</span><br><span class="line">                          <span class="number">1</span>, <span class="number">0</span>, <span class="number">74</span>, <span class="number">2</span>, <span class="number">50</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">78</span>, <span class="number">2</span>, <span class="number">17</span>, <span class="number">53</span>, <span class="number">2</span>, <span class="number">53</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">80</span>,</span><br><span class="line">                          <span class="number">2</span>, <span class="number">0</span>, <span class="number">81</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">79</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">81</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">81</span>, <span class="number">2</span>, <span class="number">24</span>, <span class="number">44</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">79</span>,</span><br><span class="line">                          <span class="number">2</span>, <span class="number">27</span>, <span class="number">44</span>&#125;,</span><br><span class="line">              llng[<span class="number">106</span>] = &#123;<span class="number">57</span>, <span class="number">25</span>, <span class="number">82</span>, <span class="number">34</span>, <span class="number">41</span>, <span class="number">66</span>, <span class="number">33</span>, <span class="number">36</span>, <span class="number">19</span>, <span class="number">88</span>, <span class="number">18</span>, <span class="number">104</span>, <span class="number">93</span>,</span><br><span class="line">                           <span class="number">84</span>, <span class="number">47</span>, <span class="number">28</span>, <span class="number">83</span>, <span class="number">86</span>, <span class="number">69</span>, <span class="number">75</span>, <span class="number">89</span>, <span class="number">30</span>, <span class="number">58</span>, <span class="number">73</span>, <span class="number">46</span>, <span class="number">77</span>,</span><br><span class="line">                           <span class="number">23</span>, <span class="number">32</span>, <span class="number">59</span>, <span class="number">72</span>, <span class="number">31</span>, <span class="number">16</span>, <span class="number">74</span>, <span class="number">22</span>, <span class="number">98</span>, <span class="number">38</span>, <span class="number">62</span>, <span class="number">96</span>, <span class="number">37</span>,</span><br><span class="line">                           <span class="number">35</span>, <span class="number">6</span>, <span class="number">76</span>, <span class="number">85</span>, <span class="number">51</span>, <span class="number">26</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">63</span>, <span class="number">105</span>, <span class="number">52</span>, <span class="number">102</span>, <span class="number">67</span>,</span><br><span class="line">                           <span class="number">99</span>, <span class="number">15</span>, <span class="number">24</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">100</span>, <span class="number">65</span>, <span class="number">11</span>, <span class="number">55</span>, <span class="number">68</span>, <span class="number">20</span>, <span class="number">87</span>, <span class="number">64</span>,</span><br><span class="line">                           <span class="number">95</span>, <span class="number">27</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">80</span>, <span class="number">91</span>, <span class="number">94</span>, <span class="number">12</span>, <span class="number">43</span>, <span class="number">71</span>, <span class="number">42</span>, <span class="number">97</span>, <span class="number">70</span>,</span><br><span class="line">                           <span class="number">7</span>, <span class="number">49</span>, <span class="number">29</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">92</span>, <span class="number">50</span>, <span class="number">78</span>, <span class="number">56</span>, <span class="number">17</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">90</span>,</span><br><span class="line">                           <span class="number">8</span>, <span class="number">39</span>, <span class="number">54</span>, <span class="number">81</span>, <span class="number">21</span>, <span class="number">103</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">101</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">44</span>,</span><br><span class="line">                           <span class="number">79</span>, <span class="number">4</span>&#125;,</span><br><span class="line">              llngx[<span class="number">14</span>] = &#123;<span class="number">81</span>, <span class="number">7</span>, <span class="number">97</span>, <span class="number">0</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">9</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">103</span>, <span class="number">101</span>, <span class="number">79</span>, <span class="number">1</span>, <span class="number">4</span>&#125;,</span><br><span class="line">              lobl[<span class="number">64</span>] = &#123;<span class="number">51</span>, <span class="number">98</span>, <span class="number">17</span>, <span class="number">21</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">63</span>, <span class="number">105</span>, <span class="number">38</span>, <span class="number">52</span>, <span class="number">102</span>, <span class="number">62</span>, <span class="number">96</span>,</span><br><span class="line">                          <span class="number">37</span>, <span class="number">35</span>, <span class="number">76</span>, <span class="number">36</span>, <span class="number">88</span>, <span class="number">85</span>, <span class="number">104</span>, <span class="number">93</span>, <span class="number">84</span>, <span class="number">83</span>, <span class="number">67</span>, <span class="number">99</span>, <span class="number">8</span>,</span><br><span class="line">                          <span class="number">68</span>, <span class="number">100</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">91</span>, <span class="number">87</span>, <span class="number">64</span>, <span class="number">80</span>, <span class="number">95</span>, <span class="number">65</span>, <span class="number">55</span>, <span class="number">94</span>, <span class="number">43</span>,</span><br><span class="line">                          <span class="number">97</span>, <span class="number">0</span>, <span class="number">71</span>, <span class="number">70</span>, <span class="number">42</span>, <span class="number">49</span>, <span class="number">92</span>, <span class="number">50</span>, <span class="number">78</span>, <span class="number">56</span>, <span class="number">90</span>, <span class="number">48</span>, <span class="number">40</span>,</span><br><span class="line">                          <span class="number">39</span>, <span class="number">54</span>, <span class="number">1</span>, <span class="number">81</span>, <span class="number">103</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">101</span>, <span class="number">9</span>, <span class="number">44</span>, <span class="number">79</span>, <span class="number">4</span>&#125;,</span><br><span class="line">              loblx[<span class="number">8</span>] = &#123;<span class="number">53</span>, <span class="number">1</span>, <span class="number">103</span>, <span class="number">9</span>, <span class="number">44</span>, <span class="number">101</span>, <span class="number">79</span>, <span class="number">4</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> a[<span class="number">5</span>], angle, cc, ss1, cs, sc, c[<span class="number">106</span>], s[<span class="number">106</span>], lng, lngx, obl,</span><br><span class="line">        oblx;</span><br><span class="line"></span><br><span class="line">    fund_args(t, a);</span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (ii = <span class="number">0</span>; ii &lt; <span class="number">10</span>; ii += <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        angle = a[nav1[ii]] * (<span class="keyword">double</span>)(nav1[<span class="number">1</span> + ii] + <span class="number">1</span>);</span><br><span class="line">        c[i] = <span class="built_in">cos</span>(angle);</span><br><span class="line">        s[i] = <span class="built_in">sin</span>(angle);</span><br><span class="line">        i += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    i = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">for</span> (ii = <span class="number">0</span>; ii &lt; <span class="number">10</span>; ii += <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        i1 = nav2[ii];</span><br><span class="line">        i2 = nav2[<span class="number">1</span> + ii];</span><br><span class="line"></span><br><span class="line">        c[i] = c[i1] * c[i2] - s[i1] * s[i2];</span><br><span class="line">        s[i] = s[i1] * c[i2] + c[i1] * s[i2];</span><br><span class="line">        i += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    i = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">for</span> (ii = <span class="number">0</span>; ii &lt; <span class="number">183</span>; ii += <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        iop = nav[ii];</span><br><span class="line">        i1 = nav[<span class="number">1</span> + ii];</span><br><span class="line">        i2 = nav[<span class="number">2</span> + ii];</span><br><span class="line">        <span class="keyword">switch</span> (iop)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            c[i] = c[i1] * c[i2] - s[i1] * s[i2];</span><br><span class="line">            s[i] = s[i1] * c[i2] + c[i1] * s[i2];</span><br><span class="line">            i += <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            c[i] = c[i1] * c[i2] + s[i1] * s[i2];</span><br><span class="line">            s[i] = s[i1] * c[i2] - c[i1] * s[i2];</span><br><span class="line">            i += <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            cc = c[i1] * c[i2];</span><br><span class="line">            ss1 = s[i1] * s[i2];</span><br><span class="line">            sc = s[i1] * c[i2];</span><br><span class="line">            cs = c[i1] * s[i2];</span><br><span class="line">            c[i] = cc - ss1;</span><br><span class="line">            s[i] = sc + cs;</span><br><span class="line">            i += <span class="number">1</span>;</span><br><span class="line">            c[i] = cc + ss1;</span><br><span class="line">            s[i] = sc - cs;</span><br><span class="line">            i += <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (iop == <span class="number">3</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    lng = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">106</span>; i++)</span><br><span class="line">        lng += clng[i] * s[llng[i]];</span><br><span class="line"></span><br><span class="line">    lngx = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">14</span>; i++)</span><br><span class="line">        lngx += clngx[i] * s[llngx[i]];</span><br><span class="line"></span><br><span class="line">    obl = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++)</span><br><span class="line">        obl += cobl[i] * c[lobl[i]];</span><br><span class="line"></span><br><span class="line">    oblx = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">        oblx += coblx[i] * c[loblx[i]];</span><br><span class="line"></span><br><span class="line">    *longnutation = (lng + t * lngx) / <span class="number">10000.0</span>;</span><br><span class="line">    *obliqnutation = (obl + t * oblx) / <span class="number">10000.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">earthtilt</span><span class="params">(<span class="keyword">double</span> tjd, <span class="keyword">double</span> *mobl, <span class="keyword">double</span> *tobl, <span class="keyword">double</span> *eq, <span class="keyword">double</span> *dpsi, <span class="keyword">double</span> *deps)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">double</span> tjd_last = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">double</span> t, dp, de;</span><br><span class="line">    <span class="keyword">double</span> mean_obliq, true_obliq, eq_eq, args[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    t = (tjd - T0) / <span class="number">36525.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(tjd - tjd_last) &gt; <span class="number">1.0e-6</span>)</span><br><span class="line">        nutation_angles(t, &amp;dp, &amp;de);</span><br><span class="line"></span><br><span class="line">    mean_obliq = <span class="number">84381.4480</span> - <span class="number">46.8150</span> * t - <span class="number">0.00059</span> * <span class="built_in">pow</span>(t, <span class="number">2.0</span>) + <span class="number">0.001813</span> * <span class="built_in">pow</span>(t, <span class="number">3.0</span>);</span><br><span class="line"></span><br><span class="line">    true_obliq = mean_obliq + de;</span><br><span class="line"></span><br><span class="line">    mean_obliq /= <span class="number">3600.0</span>;</span><br><span class="line">    true_obliq /= <span class="number">3600.0</span>;</span><br><span class="line"></span><br><span class="line">    fund_args(t, args);</span><br><span class="line"></span><br><span class="line">    eq_eq = dp * <span class="built_in">cos</span>(mean_obliq * DEG2RAD) +</span><br><span class="line">            (<span class="number">0.00264</span> * <span class="built_in">sin</span>(args[<span class="number">4</span>]) + <span class="number">0.000063</span> * <span class="built_in">sin</span>(<span class="number">2.0</span> * args[<span class="number">4</span>]));</span><br><span class="line"></span><br><span class="line">    eq_eq /= <span class="number">15.0</span>;</span><br><span class="line"></span><br><span class="line">    *dpsi = dp;</span><br><span class="line">    *deps = de;</span><br><span class="line">    *eq = eq_eq;</span><br><span class="line">    *mobl = mean_obliq;</span><br><span class="line">    *tobl = true_obliq;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">starvectors</span><span class="params">(cat_entry *star, <span class="keyword">double</span> *pos, <span class="keyword">double</span> *vel)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> paralx, dist, r, d, cra, sra, cdc, sdc, pmr, pmd, rvl;</span><br><span class="line"></span><br><span class="line">    paralx = star-&gt;parallax;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (star-&gt;parallax &lt;= <span class="number">0.0</span>)</span><br><span class="line">        paralx = <span class="number">1.0e-7</span>;</span><br><span class="line"></span><br><span class="line">    dist = RAD2SEC / paralx;</span><br><span class="line">    r = (star-&gt;ra) * <span class="number">15.0</span> * DEG2RAD;</span><br><span class="line">    d = (star-&gt;dec) * DEG2RAD;</span><br><span class="line">    cra = <span class="built_in">cos</span>(r);</span><br><span class="line">    sra = <span class="built_in">sin</span>(r);</span><br><span class="line">    cdc = <span class="built_in">cos</span>(d);</span><br><span class="line">    sdc = <span class="built_in">sin</span>(d);</span><br><span class="line"></span><br><span class="line">    pos[<span class="number">0</span>] = dist * cdc * cra;</span><br><span class="line">    pos[<span class="number">1</span>] = dist * cdc * sra;</span><br><span class="line">    pos[<span class="number">2</span>] = dist * sdc;</span><br><span class="line"></span><br><span class="line">    pmr = star-&gt;promora * <span class="number">15.0</span> * cdc / (paralx * <span class="number">36525.0</span>);</span><br><span class="line">    pmd = star-&gt;promodec / (paralx * <span class="number">36525.0</span>);</span><br><span class="line">    rvl = star-&gt;radialvelocity * <span class="number">86400.0</span> / KMAU;</span><br><span class="line">    vel[<span class="number">0</span>] = -pmr * sra - pmd * sdc * cra + rvl * cdc * cra;</span><br><span class="line">    vel[<span class="number">1</span>] = pmr * cra - pmd * sdc * sra + rvl * cdc * sra;</span><br><span class="line">    vel[<span class="number">2</span>] = pmd * cdc + rvl * sdc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tdb2tdt</span><span class="params">(<span class="keyword">double</span> tdb, <span class="keyword">double</span> *tdtjd, <span class="keyword">double</span> *secdiff)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> ecc = <span class="number">0.01671022</span>;</span><br><span class="line">    <span class="keyword">double</span> rev = <span class="number">1296000.0</span>;</span><br><span class="line">    <span class="keyword">double</span> tdays, m, l, lj, e;</span><br><span class="line"></span><br><span class="line">    tdays = tdb - T0;</span><br><span class="line">    m = (<span class="number">357.51716</span> + <span class="number">0.985599987</span> * tdays) * <span class="number">3600.0</span>;</span><br><span class="line">    l = (<span class="number">280.46435</span> + <span class="number">0.985609100</span> * tdays) * <span class="number">3600.0</span>;</span><br><span class="line">    lj = (<span class="number">34.40438</span> + <span class="number">0.083086762</span> * tdays) * <span class="number">3600.0</span>;</span><br><span class="line">    m = <span class="built_in">fmod</span>(m, rev) / RAD2SEC;</span><br><span class="line">    l = <span class="built_in">fmod</span>(l, rev) / RAD2SEC;</span><br><span class="line">    lj = <span class="built_in">fmod</span>(lj, rev) / RAD2SEC;</span><br><span class="line">    e = m + ecc * <span class="built_in">sin</span>(m) + <span class="number">0.5</span> * ecc * ecc * <span class="built_in">sin</span>(<span class="number">2.0</span> * m);</span><br><span class="line">    *secdiff = <span class="number">1.658e-3</span> * <span class="built_in">sin</span>(e) + <span class="number">20.73e-6</span> * <span class="built_in">sin</span>(l - lj);</span><br><span class="line">    *tdtjd = tdb - *secdiff / <span class="number">86400.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">precession</span><span class="params">(<span class="keyword">double</span> tjd1, <span class="keyword">double</span> *pos, <span class="keyword">double</span> tjd2, <span class="keyword">double</span> *pos2)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transform_cat</span><span class="params">(cat_entry *incat, cat_entry *newcat)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> j;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> paralx, dist, r, d, cra, sra, cdc, sdc, pos1[<span class="number">3</span>], term1, pmr, pmd, rvl, vel1[<span class="number">3</span>], pos2[<span class="number">3</span>], vel2[<span class="number">3</span>], xyproj;</span><br><span class="line"></span><br><span class="line">    paralx = incat-&gt;parallax;</span><br><span class="line">    <span class="keyword">if</span> (paralx &lt;= <span class="number">0.0</span>)</span><br><span class="line">        paralx = <span class="number">1.0e-7</span>;</span><br><span class="line"></span><br><span class="line">    dist = RAD2SEC / paralx;</span><br><span class="line">    r = incat-&gt;ra * <span class="number">54000.0</span> / RAD2SEC;</span><br><span class="line">    d = incat-&gt;dec * <span class="number">3600.0</span> / RAD2SEC;</span><br><span class="line">    cra = <span class="built_in">cos</span>(r);</span><br><span class="line">    sra = <span class="built_in">sin</span>(r);</span><br><span class="line">    cdc = <span class="built_in">cos</span>(d);</span><br><span class="line">    sdc = <span class="built_in">sin</span>(d);</span><br><span class="line">    pos1[<span class="number">0</span>] = dist * cdc * cra;</span><br><span class="line">    pos1[<span class="number">1</span>] = dist * cdc * sra;</span><br><span class="line">    pos1[<span class="number">2</span>] = dist * sdc;</span><br><span class="line"></span><br><span class="line">    term1 = paralx * <span class="number">36525.0</span>;</span><br><span class="line">    pmr = incat-&gt;promora * <span class="number">15.0</span> * cdc / term1;</span><br><span class="line">    pmd = incat-&gt;promodec / term1;</span><br><span class="line"></span><br><span class="line">    vel1[<span class="number">0</span>] = -pmr * sra - pmd * sdc * cra;</span><br><span class="line">    vel1[<span class="number">1</span>] = pmr * cra - pmd * sdc * sra;</span><br><span class="line">    vel1[<span class="number">2</span>] = pmd * cdc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        pos2[j] = pos1[j] + vel1[j] * (epoch_fk5 - epoch_hip);</span><br><span class="line">        vel2[j] = vel1[j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    xyproj = <span class="built_in">sqrt</span>(pos2[<span class="number">0</span>] * pos2[<span class="number">0</span>] + pos2[<span class="number">1</span>] * pos2[<span class="number">1</span>]);</span><br><span class="line">    r = <span class="built_in">atan2</span>(pos2[<span class="number">1</span>], pos2[<span class="number">0</span>]);</span><br><span class="line">    d = <span class="built_in">atan2</span>(pos2[<span class="number">2</span>], xyproj);</span><br><span class="line">    newcat-&gt;ra = r * RAD2SEC / <span class="number">54000.0</span>;</span><br><span class="line">    newcat-&gt;dec = d * RAD2SEC / <span class="number">3600.0</span>;</span><br><span class="line">    <span class="keyword">if</span> (newcat-&gt;ra &lt; <span class="number">0.0</span>)</span><br><span class="line">        newcat-&gt;ra += <span class="number">24.0</span>;</span><br><span class="line"></span><br><span class="line">    dist = <span class="built_in">sqrt</span>(pos2[<span class="number">0</span>] * pos2[<span class="number">0</span>] + pos2[<span class="number">1</span>] * pos2[<span class="number">1</span>] +</span><br><span class="line">                pos2[<span class="number">2</span>] * pos2[<span class="number">2</span>]);</span><br><span class="line">    paralx = RAD2SEC / dist;</span><br><span class="line">    newcat-&gt;parallax = paralx;</span><br><span class="line"></span><br><span class="line">    cra = <span class="built_in">cos</span>(r);</span><br><span class="line">    sra = <span class="built_in">sin</span>(r);</span><br><span class="line">    cdc = <span class="built_in">cos</span>(d);</span><br><span class="line">    sdc = <span class="built_in">sin</span>(d);</span><br><span class="line">    pmr = -vel2[<span class="number">0</span>] * sra + vel2[<span class="number">1</span>] * cra;</span><br><span class="line">    pmd = -vel2[<span class="number">0</span>] * cra * sdc - vel2[<span class="number">1</span>] * sra * sdc + vel2[<span class="number">2</span>] * cdc;</span><br><span class="line">    rvl = vel2[<span class="number">0</span>] * cra * cdc + vel2[<span class="number">1</span>] * sra * cdc + vel2[<span class="number">2</span>] * sdc;</span><br><span class="line"></span><br><span class="line">    newcat-&gt;promora = pmr * paralx * <span class="number">36525.0</span> / (<span class="number">15.0</span> * cdc);</span><br><span class="line">    newcat-&gt;promodec = pmd * paralx * <span class="number">36525.0</span>;</span><br><span class="line">    newcat-&gt;radialvelocity = rvl * KMAU / <span class="number">86400.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (newcat-&gt;parallax &lt;= <span class="number">1.01e-7</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        newcat-&gt;parallax = <span class="number">0.0</span>;</span><br><span class="line">        newcat-&gt;radialvelocity = incat-&gt;radialvelocity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    newcat-&gt;starnumber = incat-&gt;starnumber;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transform_hip</span><span class="params">(cat_entry *hipparcos, cat_entry *fk5)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cat_entry scratch;</span><br><span class="line">    scratch.starnumber = hipparcos-&gt;starnumber;</span><br><span class="line">    scratch.dec = hipparcos-&gt;dec;</span><br><span class="line">    scratch.radialvelocity = hipparcos-&gt;radialvelocity;</span><br><span class="line"></span><br><span class="line">    scratch.ra = hipparcos-&gt;ra / <span class="number">15.0</span>;</span><br><span class="line">    scratch.promora = hipparcos-&gt;promora / (<span class="number">150.0</span> *</span><br><span class="line">                                            <span class="built_in">cos</span>(hipparcos-&gt;dec * DEG2RAD));</span><br><span class="line">    scratch.promodec = hipparcos-&gt;promodec / <span class="number">10.0</span>;</span><br><span class="line">    scratch.parallax = hipparcos-&gt;parallax / <span class="number">1000.0</span>;</span><br><span class="line"></span><br><span class="line">    transform_cat(&amp;scratch, fk5);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sun_eph</span><span class="params">(<span class="keyword">double</span> jd, <span class="keyword">double</span> *ra, <span class="keyword">double</span> *dec, <span class="keyword">double</span> *dis)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> sum_lon = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">double</span> sum_r = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> factor = <span class="number">1.0e-07</span>;</span><br><span class="line">    <span class="keyword">double</span> u, arg, lon, lat, t, t2, emean, sin_lon;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sun_con</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="keyword">double</span> l;</span><br><span class="line">        <span class="keyword">double</span> r;</span><br><span class="line">        <span class="keyword">double</span> alpha;</span><br><span class="line">        <span class="keyword">double</span> nu;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">sun_con</span> <span class="title">con</span>[50] =</span></span><br><span class="line">        &#123;&#123;<span class="number">403406.0</span>, <span class="number">0.0</span>, <span class="number">4.721964</span>, <span class="number">1.621043</span>&#125;,</span><br><span class="line">         &#123;<span class="number">195207.0</span>, <span class="number">-97597.0</span>, <span class="number">5.937458</span>, <span class="number">62830.348067</span>&#125;,</span><br><span class="line">         &#123;<span class="number">119433.0</span>, <span class="number">-59715.0</span>, <span class="number">1.115589</span>, <span class="number">62830.821524</span>&#125;,</span><br><span class="line">         &#123;<span class="number">112392.0</span>, <span class="number">-56188.0</span>, <span class="number">5.781616</span>, <span class="number">62829.634302</span>&#125;,</span><br><span class="line">         &#123;<span class="number">3891.0</span>, <span class="number">-1556.0</span>, <span class="number">5.5474</span>, <span class="number">125660.5691</span>&#125;,</span><br><span class="line">         &#123;<span class="number">2819.0</span>, <span class="number">-1126.0</span>, <span class="number">1.5120</span>, <span class="number">125660.9845</span>&#125;,</span><br><span class="line">         &#123;<span class="number">1721.0</span>, <span class="number">-861.0</span>, <span class="number">4.1897</span>, <span class="number">62832.4766</span>&#125;,</span><br><span class="line">         &#123;<span class="number">0.0</span>, <span class="number">941.0</span>, <span class="number">1.163</span>, <span class="number">0.813</span>&#125;,</span><br><span class="line">         &#123;<span class="number">660.0</span>, <span class="number">-264.0</span>, <span class="number">5.415</span>, <span class="number">125659.310</span>&#125;,</span><br><span class="line">         &#123;<span class="number">350.0</span>, <span class="number">-163.0</span>, <span class="number">4.315</span>, <span class="number">57533.850</span>&#125;,</span><br><span class="line">         &#123;<span class="number">334.0</span>, <span class="number">0.0</span>, <span class="number">4.553</span>, <span class="number">-33.931</span>&#125;,</span><br><span class="line">         &#123;<span class="number">314.0</span>, <span class="number">309.0</span>, <span class="number">5.198</span>, <span class="number">777137.715</span>&#125;,</span><br><span class="line">         &#123;<span class="number">268.0</span>, <span class="number">-158.0</span>, <span class="number">5.989</span>, <span class="number">78604.191</span>&#125;,</span><br><span class="line">         &#123;<span class="number">242.0</span>, <span class="number">0.0</span>, <span class="number">2.911</span>, <span class="number">5.412</span>&#125;,</span><br><span class="line">         &#123;<span class="number">234.0</span>, <span class="number">-54.0</span>, <span class="number">1.423</span>, <span class="number">39302.098</span>&#125;,</span><br><span class="line">         &#123;<span class="number">158.0</span>, <span class="number">0.0</span>, <span class="number">0.061</span>, <span class="number">-34.861</span>&#125;,</span><br><span class="line">         &#123;<span class="number">132.0</span>, <span class="number">-93.0</span>, <span class="number">2.317</span>, <span class="number">115067.698</span>&#125;,</span><br><span class="line">         &#123;<span class="number">129.0</span>, <span class="number">-20.0</span>, <span class="number">3.193</span>, <span class="number">15774.337</span>&#125;,</span><br><span class="line">         &#123;<span class="number">114.0</span>, <span class="number">0.0</span>, <span class="number">2.828</span>, <span class="number">5296.670</span>&#125;,</span><br><span class="line">         &#123;<span class="number">99.0</span>, <span class="number">-47.0</span>, <span class="number">0.52</span>, <span class="number">58849.27</span>&#125;,</span><br><span class="line">         &#123;<span class="number">93.0</span>, <span class="number">0.0</span>, <span class="number">4.65</span>, <span class="number">5296.11</span>&#125;,</span><br><span class="line">         &#123;<span class="number">86.0</span>, <span class="number">0.0</span>, <span class="number">4.35</span>, <span class="number">-3980.70</span>&#125;,</span><br><span class="line">         &#123;<span class="number">78.0</span>, <span class="number">-33.0</span>, <span class="number">2.75</span>, <span class="number">52237.69</span>&#125;,</span><br><span class="line">         &#123;<span class="number">72.0</span>, <span class="number">-32.0</span>, <span class="number">4.50</span>, <span class="number">55076.47</span>&#125;,</span><br><span class="line">         &#123;<span class="number">68.0</span>, <span class="number">0.0</span>, <span class="number">3.23</span>, <span class="number">261.08</span>&#125;,</span><br><span class="line">         &#123;<span class="number">64.0</span>, <span class="number">-10.0</span>, <span class="number">1.22</span>, <span class="number">15773.85</span>&#125;,</span><br><span class="line">         &#123;<span class="number">46.0</span>, <span class="number">-16.0</span>, <span class="number">0.14</span>, <span class="number">188491.03</span>&#125;,</span><br><span class="line">         &#123;<span class="number">38.0</span>, <span class="number">0.0</span>, <span class="number">3.44</span>, <span class="number">-7756.55</span>&#125;,</span><br><span class="line">         &#123;<span class="number">37.0</span>, <span class="number">0.0</span>, <span class="number">4.37</span>, <span class="number">264.89</span>&#125;,</span><br><span class="line">         &#123;<span class="number">32.0</span>, <span class="number">-24.0</span>, <span class="number">1.14</span>, <span class="number">117906.27</span>&#125;,</span><br><span class="line">         &#123;<span class="number">29.0</span>, <span class="number">-13.0</span>, <span class="number">2.84</span>, <span class="number">55075.75</span>&#125;,</span><br><span class="line">         &#123;<span class="number">28.0</span>, <span class="number">0.0</span>, <span class="number">5.96</span>, <span class="number">-7961.39</span>&#125;,</span><br><span class="line">         &#123;<span class="number">27.0</span>, <span class="number">-9.0</span>, <span class="number">5.09</span>, <span class="number">188489.81</span>&#125;,</span><br><span class="line">         &#123;<span class="number">27.0</span>, <span class="number">0.0</span>, <span class="number">1.72</span>, <span class="number">2132.19</span>&#125;,</span><br><span class="line">         &#123;<span class="number">25.0</span>, <span class="number">-17.0</span>, <span class="number">2.56</span>, <span class="number">109771.03</span>&#125;,</span><br><span class="line">         &#123;<span class="number">24.0</span>, <span class="number">-11.0</span>, <span class="number">1.92</span>, <span class="number">54868.56</span>&#125;,</span><br><span class="line">         &#123;<span class="number">21.0</span>, <span class="number">0.0</span>, <span class="number">0.09</span>, <span class="number">25443.93</span>&#125;,</span><br><span class="line">         &#123;<span class="number">21.0</span>, <span class="number">31.0</span>, <span class="number">5.98</span>, <span class="number">-55731.43</span>&#125;,</span><br><span class="line">         &#123;<span class="number">20.0</span>, <span class="number">-10.0</span>, <span class="number">4.03</span>, <span class="number">60697.74</span>&#125;,</span><br><span class="line">         &#123;<span class="number">18.0</span>, <span class="number">0.0</span>, <span class="number">4.27</span>, <span class="number">2132.79</span>&#125;,</span><br><span class="line">         &#123;<span class="number">17.0</span>, <span class="number">-12.0</span>, <span class="number">0.79</span>, <span class="number">109771.63</span>&#125;,</span><br><span class="line">         &#123;<span class="number">14.0</span>, <span class="number">0.0</span>, <span class="number">4.24</span>, <span class="number">-7752.82</span>&#125;,</span><br><span class="line">         &#123;<span class="number">13.0</span>, <span class="number">-5.0</span>, <span class="number">2.01</span>, <span class="number">188491.91</span>&#125;,</span><br><span class="line">         &#123;<span class="number">13.0</span>, <span class="number">0.0</span>, <span class="number">2.65</span>, <span class="number">207.81</span>&#125;,</span><br><span class="line">         &#123;<span class="number">13.0</span>, <span class="number">0.0</span>, <span class="number">4.98</span>, <span class="number">29424.63</span>&#125;,</span><br><span class="line">         &#123;<span class="number">12.0</span>, <span class="number">0.0</span>, <span class="number">0.93</span>, <span class="number">-7.99</span>&#125;,</span><br><span class="line">         &#123;<span class="number">10.0</span>, <span class="number">0.0</span>, <span class="number">2.21</span>, <span class="number">46941.14</span>&#125;,</span><br><span class="line">         &#123;<span class="number">10.0</span>, <span class="number">0.0</span>, <span class="number">3.59</span>, <span class="number">-68.29</span>&#125;,</span><br><span class="line">         &#123;<span class="number">10.0</span>, <span class="number">0.0</span>, <span class="number">1.50</span>, <span class="number">21463.25</span>&#125;,</span><br><span class="line">         &#123;<span class="number">10.0</span>, <span class="number">-9.0</span>, <span class="number">2.55</span>, <span class="number">157208.40</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    u = (jd - T0) / <span class="number">3652500.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        arg = con[i].alpha + con[i].nu * u;</span><br><span class="line">        sum_lon += con[i].l * <span class="built_in">sin</span>(arg);</span><br><span class="line">        sum_r += con[i].r * <span class="built_in">cos</span>(arg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    lon = <span class="number">4.9353929</span> + <span class="number">62833.1961680</span> * u + factor * sum_lon;</span><br><span class="line"></span><br><span class="line">    lon = <span class="built_in">fmod</span>(lon, TWOPI);</span><br><span class="line">    <span class="keyword">if</span> (lon &lt; <span class="number">0.0</span>)</span><br><span class="line">        lon += TWOPI;</span><br><span class="line"></span><br><span class="line">    lat = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    *dis = <span class="number">1.0001026</span> + factor * sum_r;</span><br><span class="line"></span><br><span class="line">    t = u * <span class="number">100.0</span>;</span><br><span class="line">    t2 = t * t;</span><br><span class="line">    emean = (<span class="number">0.001813</span> * t2 * t - <span class="number">0.00059</span> * t2 - <span class="number">46.8150</span> * t + <span class="number">84381.448</span>) / RAD2SEC;</span><br><span class="line"></span><br><span class="line">    sin_lon = <span class="built_in">sin</span>(lon);</span><br><span class="line">    *ra = <span class="built_in">atan2</span>((<span class="built_in">cos</span>(emean) * sin_lon), <span class="built_in">cos</span>(lon)) * RAD2DEG;</span><br><span class="line">    *ra = <span class="built_in">fmod</span>(*ra, <span class="number">360.0</span>);</span><br><span class="line">    <span class="keyword">if</span> (*ra &lt; <span class="number">0.0</span>)</span><br><span class="line">        *ra += <span class="number">360.0</span>;</span><br><span class="line">    *ra = *ra / <span class="number">15.0</span>;</span><br><span class="line"></span><br><span class="line">    *dec = <span class="built_in">asin</span>(<span class="built_in">sin</span>(emean) * sin_lon) * RAD2DEG;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">precession</span><span class="params">(<span class="keyword">double</span> tjd1, <span class="keyword">double</span> *pos, <span class="keyword">double</span> tjd2, <span class="keyword">double</span> *pos2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> xx, yx, zx, xy, yy, zy, xz, yz, zz, t, t1, t02, t2, t3, zeta0, zee, theta;</span><br><span class="line"></span><br><span class="line">    t = (tjd1 - T0) / <span class="number">36525.0</span>;</span><br><span class="line">    t1 = (tjd2 - tjd1) / <span class="number">36525.0</span>;</span><br><span class="line">    t02 = t * t;</span><br><span class="line">    t2 = t1 * t1;</span><br><span class="line">    t3 = t2 * t1;</span><br><span class="line">    zeta0 = (<span class="number">2306.2181</span> + <span class="number">1.39656</span> * t - <span class="number">0.000139</span> * t02) * t1 + (<span class="number">0.30188</span> - <span class="number">0.000344</span> * t) * t2 + <span class="number">0.017998</span> * t3;</span><br><span class="line"></span><br><span class="line">    zee = (<span class="number">2306.2181</span> + <span class="number">1.39656</span> * t - <span class="number">0.000139</span> * t02) * t1 + (<span class="number">1.09468</span> + <span class="number">0.000066</span> * t) * t2 + <span class="number">0.018203</span> * t3;</span><br><span class="line"></span><br><span class="line">    theta = (<span class="number">2004.3109</span> - <span class="number">0.85330</span> * t - <span class="number">0.000217</span> * t02) * t1 + (<span class="number">-0.42665</span> - <span class="number">0.000217</span> * t) * t2 - <span class="number">0.041833</span> * t3;</span><br><span class="line"></span><br><span class="line">    zeta0 /= RAD2SEC;</span><br><span class="line">    zee /= RAD2SEC;</span><br><span class="line">    theta /= RAD2SEC;</span><br><span class="line">    xx = <span class="built_in">cos</span>(zeta0) * <span class="built_in">cos</span>(theta) * <span class="built_in">cos</span>(zee) - <span class="built_in">sin</span>(zeta0) * <span class="built_in">sin</span>(zee);</span><br><span class="line">    yx = -<span class="built_in">sin</span>(zeta0) * <span class="built_in">cos</span>(theta) * <span class="built_in">cos</span>(zee) - <span class="built_in">cos</span>(zeta0) *</span><br><span class="line">                                                   <span class="built_in">sin</span>(zee);</span><br><span class="line">    zx = -<span class="built_in">sin</span>(theta) * <span class="built_in">cos</span>(zee);</span><br><span class="line">    xy = <span class="built_in">cos</span>(zeta0) * <span class="built_in">cos</span>(theta) * <span class="built_in">sin</span>(zee) + <span class="built_in">sin</span>(zeta0) * <span class="built_in">cos</span>(zee);</span><br><span class="line">    yy = -<span class="built_in">sin</span>(zeta0) * <span class="built_in">cos</span>(theta) * <span class="built_in">sin</span>(zee) + <span class="built_in">cos</span>(zeta0) *</span><br><span class="line">                                                   <span class="built_in">cos</span>(zee);</span><br><span class="line">    zy = -<span class="built_in">sin</span>(theta) * <span class="built_in">sin</span>(zee);</span><br><span class="line">    xz = <span class="built_in">cos</span>(zeta0) * <span class="built_in">sin</span>(theta);</span><br><span class="line">    yz = -<span class="built_in">sin</span>(zeta0) * <span class="built_in">sin</span>(theta);</span><br><span class="line">    zz = <span class="built_in">cos</span>(theta);</span><br><span class="line">    pos2[<span class="number">0</span>] = xx * pos[<span class="number">0</span>] + yx * pos[<span class="number">1</span>] + zx * pos[<span class="number">2</span>];</span><br><span class="line">    pos2[<span class="number">1</span>] = xy * pos[<span class="number">0</span>] + yy * pos[<span class="number">1</span>] + zy * pos[<span class="number">2</span>];</span><br><span class="line">    pos2[<span class="number">2</span>] = xz * pos[<span class="number">0</span>] + yz * pos[<span class="number">1</span>] + zz * pos[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">radec2vector</span><span class="params">(<span class="keyword">double</span> ra, <span class="keyword">double</span> dec, <span class="keyword">double</span> dist, <span class="keyword">double</span> *<span class="built_in">vector</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>[<span class="number">0</span>] = dist * <span class="built_in">cos</span>(DEG2RAD * dec) * <span class="built_in">cos</span>(DEG2RAD * <span class="number">15.0</span> * ra);</span><br><span class="line">    <span class="built_in">vector</span>[<span class="number">1</span>] = dist * <span class="built_in">cos</span>(DEG2RAD * dec) * <span class="built_in">sin</span>(DEG2RAD * <span class="number">15.0</span> * ra);</span><br><span class="line">    <span class="built_in">vector</span>[<span class="number">2</span>] = dist * <span class="built_in">sin</span>(DEG2RAD * dec);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">short</span> <span class="keyword">int</span> <span class="title">solarsystem</span><span class="params">(<span class="keyword">double</span> tjd, <span class="keyword">short</span> <span class="keyword">int</span> origin, <span class="keyword">double</span> *pos, <span class="keyword">double</span> *vel)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> ierr = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> pm[<span class="number">4</span>] = &#123;<span class="number">1047.349</span>, <span class="number">3497.898</span>, <span class="number">22903.0</span>, <span class="number">19412.2</span>&#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> pa[<span class="number">4</span>] = &#123;<span class="number">5.203363</span>, <span class="number">9.537070</span>, <span class="number">19.191264</span>, <span class="number">30.068963</span>&#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> pl[<span class="number">4</span>] = &#123;<span class="number">0.600470</span>, <span class="number">0.871693</span>, <span class="number">5.466933</span>, <span class="number">5.321160</span>&#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> pn[<span class="number">4</span>] = &#123;<span class="number">1.450138e-3</span>, <span class="number">5.841727e-4</span>, <span class="number">2.047497e-4</span>, <span class="number">1.043891e-4</span>&#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> obl = <span class="number">23.43929111</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">double</span> tlast = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">double</span> sine, cose, tmass, pbary[<span class="number">3</span>], vbary[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> oblr, qjd, ras, decs, diss, pos1[<span class="number">3</span>], p[<span class="number">3</span>][<span class="number">3</span>], dlon, sinl, cosl, x, y, z, xdot, ydot, zdot, f;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (tlast == <span class="number">0.0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        oblr = obl * TWOPI / <span class="number">360.0</span>;</span><br><span class="line">        sine = <span class="built_in">sin</span>(oblr);</span><br><span class="line">        cose = <span class="built_in">cos</span>(oblr);</span><br><span class="line">        tmass = <span class="number">1.0</span>;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">            tmass += <span class="number">1.0</span> / pm[i];</span><br><span class="line">        tlast = <span class="number">1.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((tjd &lt; <span class="number">2340000.5</span>) || (tjd &gt; <span class="number">2560000.5</span>))</span><br><span class="line">        <span class="keyword">return</span> (ierr = <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        qjd = tjd + (<span class="keyword">double</span>)(i - <span class="number">1</span>) * <span class="number">0.1</span>;</span><br><span class="line">        sun_eph(qjd, &amp;ras, &amp;decs, &amp;diss);</span><br><span class="line">        radec2vector(ras, decs, diss, pos1);</span><br><span class="line">        precession(qjd, pos1, T0, pos);</span><br><span class="line">        p[i][<span class="number">0</span>] = -pos[<span class="number">0</span>];</span><br><span class="line">        p[i][<span class="number">1</span>] = -pos[<span class="number">1</span>];</span><br><span class="line">        p[i][<span class="number">2</span>] = -pos[<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        pos[i] = p[<span class="number">1</span>][i];</span><br><span class="line">        vel[i] = (p[<span class="number">2</span>][i] - p[<span class="number">0</span>][i]) / <span class="number">0.2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (origin == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">fabs</span>(tjd - tlast) &gt;= <span class="number">1.0e-06</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">                pbary[i] = vbary[i] = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                dlon = pl[i] + pn[i] * (tjd - T0);</span><br><span class="line">                dlon = <span class="built_in">fmod</span>(dlon, TWOPI);</span><br><span class="line">                sinl = <span class="built_in">sin</span>(dlon);</span><br><span class="line">                cosl = <span class="built_in">cos</span>(dlon);</span><br><span class="line"></span><br><span class="line">                x = pa[i] * cosl;</span><br><span class="line">                y = pa[i] * sinl * cose;</span><br><span class="line">                z = pa[i] * sinl * sine;</span><br><span class="line">                xdot = -pa[i] * pn[i] * sinl;</span><br><span class="line">                ydot = pa[i] * pn[i] * cosl * cose;</span><br><span class="line">                zdot = pa[i] * pn[i] * cosl * sine;</span><br><span class="line"></span><br><span class="line">                f = <span class="number">1.0</span> / (pm[i] * tmass);</span><br><span class="line"></span><br><span class="line">                pbary[<span class="number">0</span>] += x * f;</span><br><span class="line">                pbary[<span class="number">1</span>] += y * f;</span><br><span class="line">                pbary[<span class="number">2</span>] += z * f;</span><br><span class="line">                vbary[<span class="number">0</span>] += xdot * f;</span><br><span class="line">                vbary[<span class="number">1</span>] += ydot * f;</span><br><span class="line">                vbary[<span class="number">2</span>] += zdot * f;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            tlast = tjd;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            pos[i] -= pbary[i];</span><br><span class="line">            vel[i] -= vbary[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (ierr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">proper_motion</span><span class="params">(<span class="keyword">double</span> tjd1, <span class="keyword">double</span> *pos, <span class="keyword">double</span> *vel, <span class="keyword">double</span> tjd2, <span class="keyword">double</span> *pos2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> j;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">        pos2[j] = pos[j] + (vel[j] * (tjd2 - tjd1));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">short</span> <span class="keyword">int</span> <span class="title">get_earth</span><span class="params">(<span class="keyword">double</span> tjd, <span class="keyword">double</span> *tdb, <span class="keyword">double</span> *bary_earthp, <span class="keyword">double</span> *bary_earthv, <span class="keyword">double</span> *helio_earthp, <span class="keyword">double</span> *helio_earthv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> error = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">double</span> tjd_last = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">double</span> time1, peb[<span class="number">3</span>], veb[<span class="number">3</span>], pes[<span class="number">3</span>], ves[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">double</span> dummy, secdiff;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(tjd - tjd_last) &gt; <span class="number">1.0e-6</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        tdb2tdt(tjd, &amp;dummy, &amp;secdiff);</span><br><span class="line">        time1 = tjd + secdiff / <span class="number">86400.0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (error = solarsystem(time1, BARYC, peb, veb))</span><br><span class="line">        &#123;</span><br><span class="line">            tjd_last = <span class="number">0.0</span>;</span><br><span class="line">            <span class="keyword">return</span> error;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (error = solarsystem(time1, HELIOC, pes, ves))</span><br><span class="line">        &#123;</span><br><span class="line">            tjd_last = <span class="number">0.0</span>;</span><br><span class="line">            <span class="keyword">return</span> error;</span><br><span class="line">        &#125;</span><br><span class="line">        tjd_last = tjd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    *tdb = time1;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">short</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        bary_earthp[i] = peb[i];</span><br><span class="line">        bary_earthv[i] = veb[i];</span><br><span class="line">        helio_earthp[i] = pes[i];</span><br><span class="line">        helio_earthv[i] = ves[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> error;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bary_to_geo</span><span class="params">(<span class="keyword">double</span> *pos, <span class="keyword">double</span> *earthvector, <span class="keyword">double</span> *pos2, <span class="keyword">double</span> *lighttime)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> j;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> sum_of_squares;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">        pos2[j] = pos[j] - earthvector[j];</span><br><span class="line"></span><br><span class="line">    sum_of_squares = <span class="built_in">pow</span>(pos2[<span class="number">0</span>], <span class="number">2.0</span>) + <span class="built_in">pow</span>(pos2[<span class="number">1</span>], <span class="number">2.0</span>) + <span class="built_in">pow</span>(pos2[<span class="number">2</span>], <span class="number">2.0</span>);</span><br><span class="line"></span><br><span class="line">    *lighttime = <span class="built_in">sqrt</span>(sum_of_squares) / C;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">short</span> <span class="keyword">int</span> <span class="title">sun_field</span><span class="params">(<span class="keyword">double</span> *pos, <span class="keyword">double</span> *earthvector, <span class="keyword">double</span> *pos2)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> j;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> f = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">double</span> p1mag, pemag, cosd, sind, b, bm, pqmag, zfinl, zinit,</span><br><span class="line">        xifinl, xiinit, delphi, delphp, delp, p1hat[<span class="number">3</span>], pehat[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> c = (C * MAU) / <span class="number">86400.0</span>;</span><br><span class="line"></span><br><span class="line">    p1mag = <span class="built_in">sqrt</span>(<span class="built_in">pow</span>(pos[<span class="number">0</span>], <span class="number">2.0</span>) + <span class="built_in">pow</span>(pos[<span class="number">1</span>], <span class="number">2.0</span>) + <span class="built_in">pow</span>(pos[<span class="number">2</span>], <span class="number">2.0</span>));</span><br><span class="line">    pemag = <span class="built_in">sqrt</span>(<span class="built_in">pow</span>(earthvector[<span class="number">0</span>], <span class="number">2.0</span>) + <span class="built_in">pow</span>(earthvector[<span class="number">1</span>], <span class="number">2.0</span>) + <span class="built_in">pow</span>(earthvector[<span class="number">2</span>], <span class="number">2.0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        p1hat[j] = pos[j] / p1mag;</span><br><span class="line">        pehat[j] = earthvector[j] / pemag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cosd = -pehat[<span class="number">0</span>] * p1hat[<span class="number">0</span>] - pehat[<span class="number">1</span>] * p1hat[<span class="number">1</span>] - pehat[<span class="number">2</span>] * p1hat[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(cosd) &gt; <span class="number">0.9999999999</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">            pos2[j] = pos[j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        sind = <span class="built_in">sqrt</span>(<span class="number">1.0</span> - <span class="built_in">pow</span>(cosd, <span class="number">2.0</span>));</span><br><span class="line"></span><br><span class="line">        b = pemag * sind;</span><br><span class="line">        bm = b * MAU;</span><br><span class="line"></span><br><span class="line">        pqmag = <span class="built_in">sqrt</span>(<span class="built_in">pow</span>(p1mag, <span class="number">2.0</span>) + <span class="built_in">pow</span>(pemag, <span class="number">2.0</span>) - <span class="number">2.0</span> * p1mag * pemag * cosd);</span><br><span class="line"></span><br><span class="line">        zfinl = pemag * cosd;</span><br><span class="line">        zinit = -p1mag + zfinl;</span><br><span class="line">        xifinl = zfinl / b;</span><br><span class="line">        xiinit = zinit / b;</span><br><span class="line"></span><br><span class="line">        delphi = <span class="number">2.0</span> * GS / (bm * c * c) * (xifinl / <span class="built_in">sqrt</span>(<span class="number">1.0</span> + <span class="built_in">pow</span>(xifinl, <span class="number">2.0</span>)) - xiinit / <span class="built_in">sqrt</span>(<span class="number">1.0</span> + <span class="built_in">pow</span>(xiinit, <span class="number">2.0</span>)));</span><br><span class="line"></span><br><span class="line">        delphp = delphi / (<span class="number">1.0</span> + (pemag / pqmag));</span><br><span class="line"></span><br><span class="line">        f = delphp * p1mag / sind;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            delp = f * (cosd * p1hat[j] + pehat[j]);</span><br><span class="line">            pos2[j] = pos[j] + delp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">short</span> <span class="keyword">int</span> <span class="title">aberration</span><span class="params">(<span class="keyword">double</span> *pos, <span class="keyword">double</span> *ve, <span class="keyword">double</span> lighttime, <span class="keyword">double</span> *pos2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> p1mag, vemag, beta, dot, cosd, gammai, p, q, r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (lighttime == <span class="number">0.0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        p1mag = <span class="built_in">sqrt</span>(<span class="built_in">pow</span>(pos[<span class="number">0</span>], <span class="number">2.0</span>) + <span class="built_in">pow</span>(pos[<span class="number">1</span>], <span class="number">2.0</span>) + <span class="built_in">pow</span>(pos[<span class="number">2</span>], <span class="number">2.0</span>));</span><br><span class="line">        lighttime = p1mag / C;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        p1mag = lighttime * C;</span><br><span class="line"></span><br><span class="line">    vemag = <span class="built_in">sqrt</span>(<span class="built_in">pow</span>(ve[<span class="number">0</span>], <span class="number">2.0</span>) + <span class="built_in">pow</span>(ve[<span class="number">1</span>], <span class="number">2.0</span>) + <span class="built_in">pow</span>(ve[<span class="number">2</span>], <span class="number">2.0</span>));</span><br><span class="line">    beta = vemag / C;</span><br><span class="line">    dot = pos[<span class="number">0</span>] * ve[<span class="number">0</span>] + pos[<span class="number">1</span>] * ve[<span class="number">1</span>] + pos[<span class="number">2</span>] * ve[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    cosd = dot / (p1mag * vemag);</span><br><span class="line">    gammai = <span class="built_in">sqrt</span>(<span class="number">1.0</span> - <span class="built_in">pow</span>(beta, <span class="number">2.0</span>));</span><br><span class="line">    p = beta * cosd;</span><br><span class="line">    q = (<span class="number">1.0</span> + p / (<span class="number">1.0</span> + gammai)) * lighttime;</span><br><span class="line">    r = <span class="number">1.0</span> + p;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">short</span> <span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">        pos2[j] = (gammai * pos[j] + q * ve[j]) / r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">short</span> <span class="keyword">int</span> <span class="title">nutate</span><span class="params">(<span class="keyword">double</span> tjd, <span class="keyword">short</span> <span class="keyword">int</span> fn, <span class="keyword">double</span> *pos, <span class="keyword">double</span> *pos2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> cobm, sobm, cobt, sobt, cpsi, spsi, xx, yx, zx, xy, yy, zy, xz, yz, zz, oblm, oblt, eqeq, psi, eps;</span><br><span class="line"></span><br><span class="line">    earthtilt(tjd, &amp;oblm, &amp;oblt, &amp;eqeq, &amp;psi, &amp;eps);</span><br><span class="line"></span><br><span class="line">    cobm = <span class="built_in">cos</span>(oblm * DEG2RAD);</span><br><span class="line">    sobm = <span class="built_in">sin</span>(oblm * DEG2RAD);</span><br><span class="line">    cobt = <span class="built_in">cos</span>(oblt * DEG2RAD);</span><br><span class="line">    sobt = <span class="built_in">sin</span>(oblt * DEG2RAD);</span><br><span class="line">    cpsi = <span class="built_in">cos</span>(psi / RAD2SEC);</span><br><span class="line">    spsi = <span class="built_in">sin</span>(psi / RAD2SEC);</span><br><span class="line"></span><br><span class="line">    xx = cpsi;</span><br><span class="line">    yx = -spsi * cobm;</span><br><span class="line">    zx = -spsi * sobm;</span><br><span class="line">    xy = spsi * cobt;</span><br><span class="line">    yy = cpsi * cobm * cobt + sobm * sobt;</span><br><span class="line">    zy = cpsi * sobm * cobt - cobm * sobt;</span><br><span class="line">    xz = spsi * sobt;</span><br><span class="line">    yz = cpsi * cobm * sobt - sobm * cobt;</span><br><span class="line">    zz = cpsi * sobm * sobt + cobm * cobt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!fn)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        pos2[<span class="number">0</span>] = xx * pos[<span class="number">0</span>] + yx * pos[<span class="number">1</span>] + zx * pos[<span class="number">2</span>];</span><br><span class="line">        pos2[<span class="number">1</span>] = xy * pos[<span class="number">0</span>] + yy * pos[<span class="number">1</span>] + zy * pos[<span class="number">2</span>];</span><br><span class="line">        pos2[<span class="number">2</span>] = xz * pos[<span class="number">0</span>] + yz * pos[<span class="number">1</span>] + zz * pos[<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        pos2[<span class="number">0</span>] = xx * pos[<span class="number">0</span>] + xy * pos[<span class="number">1</span>] + xz * pos[<span class="number">2</span>];</span><br><span class="line">        pos2[<span class="number">1</span>] = yx * pos[<span class="number">0</span>] + yy * pos[<span class="number">1</span>] + yz * pos[<span class="number">2</span>];</span><br><span class="line">        pos2[<span class="number">2</span>] = zx * pos[<span class="number">0</span>] + zy * pos[<span class="number">1</span>] + zz * pos[<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">short</span> <span class="keyword">int</span> <span class="title">app_star</span><span class="params">(<span class="keyword">double</span> tjd, cat_entry *star, <span class="keyword">double</span> *ra, <span class="keyword">double</span> *dec)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> error = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> tdb, time2, peb[<span class="number">3</span>], veb[<span class="number">3</span>], pes[<span class="number">3</span>], ves[<span class="number">3</span>], pos1[<span class="number">3</span>], pos2[<span class="number">3</span>],</span><br><span class="line">        pos3[<span class="number">3</span>], pos4[<span class="number">3</span>], pos5[<span class="number">3</span>], pos6[<span class="number">3</span>], pos7[<span class="number">3</span>], vel1[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (error = get_earth(tjd, &amp;tdb, peb, veb, pes, ves))</span><br><span class="line">    &#123;</span><br><span class="line">        *ra = <span class="number">0.0</span>;</span><br><span class="line">        *dec = <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">return</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">    starvectors(star, pos1, vel1);</span><br><span class="line">    proper_motion(T0, pos1, vel1, tdb, pos2);</span><br><span class="line"></span><br><span class="line">    bary_to_geo(pos2, peb, pos3, &amp;time2);</span><br><span class="line">    sun_field(pos3, pes, pos4);</span><br><span class="line">    aberration(pos4, veb, time2, pos5);</span><br><span class="line">    precession(T0, pos5, tdb, pos6);</span><br><span class="line">    nutate(tdb, FN0, pos6, pos7);</span><br><span class="line"></span><br><span class="line">    vector2radec(pos7, ra, dec);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spin</span><span class="params">(<span class="keyword">double</span> st, <span class="keyword">double</span> *pos1, <span class="keyword">double</span> *pos2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> str, cosst, sinst, xx, yx, xy, yy;</span><br><span class="line"></span><br><span class="line">    str = st * <span class="number">15.0</span> * DEG2RAD;</span><br><span class="line">    cosst = <span class="built_in">cos</span>(str);</span><br><span class="line">    sinst = <span class="built_in">sin</span>(str);</span><br><span class="line"></span><br><span class="line">    xx = cosst;</span><br><span class="line">    yx = -sinst;</span><br><span class="line">    xy = sinst;</span><br><span class="line">    yy = cosst;</span><br><span class="line"></span><br><span class="line">    pos2[<span class="number">0</span>] = xx * pos1[<span class="number">0</span>] + yx * pos1[<span class="number">1</span>];</span><br><span class="line">    pos2[<span class="number">1</span>] = xy * pos1[<span class="number">0</span>] + yy * pos1[<span class="number">1</span>];</span><br><span class="line">    pos2[<span class="number">2</span>] = pos1[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pnsw</span><span class="params">(<span class="keyword">double</span> gast, <span class="keyword">double</span> *vece, <span class="keyword">double</span> *vecs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> dummy, v1[<span class="number">3</span>], v2[<span class="number">3</span>], v3[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> j;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">        v1[j] = vece[j];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (gast == <span class="number">0.0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">            v2[j] = v1[j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        spin(gast, v1, v2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">        vecs[j] = v2[j];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sidereal_time</span><span class="params">(<span class="keyword">double</span> jd_high, <span class="keyword">double</span> ee, <span class="keyword">double</span> *gst)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> t_hi, t_lo, t, t2, t3, st;</span><br><span class="line"></span><br><span class="line">    t_hi = (jd_high - T0) / <span class="number">36525.0</span>;</span><br><span class="line">    t_lo = <span class="number">0</span>;</span><br><span class="line">    t = t_hi;</span><br><span class="line">    t2 = t * t;</span><br><span class="line">    t3 = t2 * t;</span><br><span class="line"></span><br><span class="line">    st = ee - <span class="number">6.2e-6</span> * t3 + <span class="number">0.093104</span> * t2 + <span class="number">67310.54841</span> + <span class="number">8640184.812866</span> * t_lo + <span class="number">3155760000.0</span> * t_lo + <span class="number">8640184.812866</span> * t_hi + <span class="number">3155760000.0</span> * t_hi;</span><br><span class="line"></span><br><span class="line">    *gst = <span class="built_in">fmod</span>((st / <span class="number">3600.0</span>), <span class="number">24.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (*gst &lt; <span class="number">0.0</span>)</span><br><span class="line">        *gst += <span class="number">24.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">equ2hor</span><span class="params">(<span class="keyword">double</span> tjd, site_info *location, <span class="keyword">double</span> ra, <span class="keyword">double</span> dec, <span class="keyword">double</span> *zd, <span class="keyword">double</span> *az, <span class="keyword">double</span> *rar, <span class="keyword">double</span> *decr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">short</span> <span class="keyword">int</span> j;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> ujd, dummy, secdiff, tdb, mobl, tobl, ee, dpsi, deps, gast,</span><br><span class="line">        sinlat, coslat, sinlon, coslon, sindc, cosdc, sinra, cosra,</span><br><span class="line">        uze[<span class="number">3</span>], une[<span class="number">3</span>], uwe[<span class="number">3</span>], uz[<span class="number">3</span>], un[<span class="number">3</span>], uw[<span class="number">3</span>], p[<span class="number">3</span>], pz, pn, pw,</span><br><span class="line">        proj, zd0, zd1, refr, cosr, prlen, rlen, pr[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    ujd = tjd;</span><br><span class="line"></span><br><span class="line">    tdb2tdt(tjd, &amp;dummy, &amp;secdiff);</span><br><span class="line">    tdb = tjd + secdiff / <span class="number">86400.0</span>;</span><br><span class="line"></span><br><span class="line">    earthtilt(tdb, &amp;mobl, &amp;tobl, &amp;ee, &amp;dpsi, &amp;deps);</span><br><span class="line"></span><br><span class="line">    sidereal_time(ujd, ee, &amp;gast);</span><br><span class="line">    *rar = ra;</span><br><span class="line">    *decr = dec;</span><br><span class="line"></span><br><span class="line">    sinlat = <span class="built_in">sin</span>(location-&gt;latitude * DEG2RAD);</span><br><span class="line">    coslat = <span class="built_in">cos</span>(location-&gt;latitude * DEG2RAD);</span><br><span class="line">    sinlon = <span class="built_in">sin</span>(location-&gt;longitude * DEG2RAD);</span><br><span class="line">    coslon = <span class="built_in">cos</span>(location-&gt;longitude * DEG2RAD);</span><br><span class="line">    sindc = <span class="built_in">sin</span>(dec * DEG2RAD);</span><br><span class="line">    cosdc = <span class="built_in">cos</span>(dec * DEG2RAD);</span><br><span class="line">    sinra = <span class="built_in">sin</span>(ra * <span class="number">15.0</span> * DEG2RAD);</span><br><span class="line">    cosra = <span class="built_in">cos</span>(ra * <span class="number">15.0</span> * DEG2RAD);</span><br><span class="line"></span><br><span class="line">    uze[<span class="number">0</span>] = coslat * coslon;</span><br><span class="line">    uze[<span class="number">1</span>] = coslat * sinlon;</span><br><span class="line">    uze[<span class="number">2</span>] = sinlat;</span><br><span class="line">    une[<span class="number">0</span>] = -sinlat * coslon;</span><br><span class="line">    une[<span class="number">1</span>] = -sinlat * sinlon;</span><br><span class="line">    une[<span class="number">2</span>] = coslat;</span><br><span class="line"></span><br><span class="line">    uwe[<span class="number">0</span>] = sinlon;</span><br><span class="line">    uwe[<span class="number">1</span>] = -coslon;</span><br><span class="line">    uwe[<span class="number">2</span>] = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    pnsw(gast, uze, uz);</span><br><span class="line">    pnsw(gast, une, un);</span><br><span class="line">    pnsw(gast, uwe, uw);</span><br><span class="line"></span><br><span class="line">    p[<span class="number">0</span>] = cosdc * cosra;</span><br><span class="line">    p[<span class="number">1</span>] = cosdc * sinra;</span><br><span class="line">    p[<span class="number">2</span>] = sindc;</span><br><span class="line"></span><br><span class="line">    pz = p[<span class="number">0</span>] * uz[<span class="number">0</span>] + p[<span class="number">1</span>] * uz[<span class="number">1</span>] + p[<span class="number">2</span>] * uz[<span class="number">2</span>];</span><br><span class="line">    pn = p[<span class="number">0</span>] * un[<span class="number">0</span>] + p[<span class="number">1</span>] * un[<span class="number">1</span>] + p[<span class="number">2</span>] * un[<span class="number">2</span>];</span><br><span class="line">    pw = p[<span class="number">0</span>] * uw[<span class="number">0</span>] + p[<span class="number">1</span>] * uw[<span class="number">1</span>] + p[<span class="number">2</span>] * uw[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    proj = <span class="built_in">sqrt</span>(pn * pn + pw * pw);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (proj &gt; <span class="number">0.0</span>)</span><br><span class="line">        *az = -<span class="built_in">atan2</span>(pw, pn) * RAD2DEG;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (*az &lt; <span class="number">0.0</span>)</span><br><span class="line">        *az += <span class="number">360.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (*az &gt;= <span class="number">360.0</span>)</span><br><span class="line">        *az -= <span class="number">360.0</span>;</span><br><span class="line"></span><br><span class="line">    *zd = <span class="built_in">atan2</span>(proj, pz) * RAD2DEG;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">julian_date</span><span class="params">(<span class="keyword">short</span> <span class="keyword">int</span> year, <span class="keyword">short</span> <span class="keyword">int</span> month, <span class="keyword">short</span> <span class="keyword">int</span> day, <span class="keyword">double</span> hour)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">int</span> jd12h = (<span class="keyword">long</span>)day - <span class="number">32075L</span> + <span class="number">1461L</span> * ((<span class="keyword">long</span>)year + <span class="number">4800L</span> + ((<span class="keyword">long</span>)month - <span class="number">14L</span>) / <span class="number">12L</span>) / <span class="number">4L</span> + <span class="number">367L</span> * ((<span class="keyword">long</span>)month - <span class="number">2L</span> - ((<span class="keyword">long</span>)month - <span class="number">14L</span>) / <span class="number">12L</span> * <span class="number">12L</span>) / <span class="number">12L</span> - <span class="number">3L</span> * (((<span class="keyword">long</span>)year + <span class="number">4900L</span> + ((<span class="keyword">long</span>)month - <span class="number">14L</span>) / <span class="number">12L</span>) / <span class="number">100L</span>) / <span class="number">4L</span>;</span><br><span class="line">    <span class="keyword">double</span> tjd = (<span class="keyword">double</span>)jd12h - <span class="number">0.5</span> + hour / <span class="number">24.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (tjd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// convert(hip_ra, hip_dec, hip_promora, hip_promodec, hip_parallax, fk5_ra, fk5_dec);</span></span><br><span class="line">    cat_entry hip = &#123;<span class="number">113368</span>, <span class="number">6.011119421</span> / TWOPI * <span class="number">360</span>, <span class="number">-0.516998583</span> / TWOPI * <span class="number">360</span>, <span class="number">328.95</span>, <span class="number">-164.67</span>, <span class="number">129.81</span>, <span class="number">0</span>&#125;; <span class="comment">// &quot;hi&quot;, &quot;beiluoshimen&quot;</span></span><br><span class="line">    <span class="comment">// cat_entry hip = &#123;&quot;ho&quot;, &quot;niulang&quot;, 97649, 5.195749333 / TWOPI * 360, 0.15476506 / TWOPI * 360, 536.23, 385.29, 194.95, 0&#125;;</span></span><br><span class="line">    <span class="comment">// cat_entry hip = &#123;&quot;hi&quot;, &quot;tianhezuo&quot;, 109268, 5.79550224 / TWOPI * 360, -0.819617367 / TWOPI * 360, 126.69, -147.47, 32.29, 0&#125;;</span></span><br><span class="line">    cat_entry fk5;</span><br><span class="line">    site_info loc = &#123;<span class="number">32.08</span>, <span class="number">118.8</span>&#125;; <span class="comment">// 温度10摄氏度 高度10米 大气压1013毫巴=1013百帕</span></span><br><span class="line">    transform_hip(&amp;hip, &amp;fk5);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; fk5.ra &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; fk5.dec &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">time_t</span> now;</span><br><span class="line">    tm *utc;</span><br><span class="line">    <span class="keyword">double</span> tjd, ra, dec, zd, az, rar, decr, rah;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        now = time(<span class="number">0</span>);</span><br><span class="line">        utc = gmtime(&amp;now);</span><br><span class="line">        tjd = julian_date(<span class="number">1900</span> + utc-&gt;tm_year, <span class="number">1</span> + utc-&gt;tm_mon, utc-&gt;tm_mday, utc-&gt;tm_hour + utc-&gt;tm_min / <span class="number">60.0</span> + utc-&gt;tm_sec / <span class="number">3600.0</span>);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; fixed &lt;&lt; setprecision(<span class="number">10</span>) &lt;&lt; tjd &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="comment">// double tjd = 2459921.90082;</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; tjd &quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(<span class="number">10</span>) &lt;&lt; tjd &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">        app_star(tjd, &amp;fk5, &amp;ra, &amp;dec);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; ra &lt;&lt; <span class="built_in">endl</span></span><br><span class="line">             &lt;&lt; dec &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        equ2hor(tjd, &amp;loc, ra, dec, &amp;zd, &amp;az, &amp;rar, &amp;decr);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="number">90</span> - zd &lt;&lt; <span class="built_in">endl</span></span><br><span class="line">             &lt;&lt; az &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; zd 高度 : &quot;</span> &lt;&lt; <span class="keyword">int</span>(<span class="number">90</span> - zd) &lt;&lt; <span class="string">&quot; ram: &quot;</span> &lt;&lt; <span class="keyword">int</span>((<span class="number">90</span> - zd - <span class="keyword">int</span>(<span class="number">90</span> - zd)) * <span class="number">60</span>) &lt;&lt; <span class="string">&quot; ras: &quot;</span> &lt;&lt; <span class="number">60</span> * ((<span class="number">90</span> - zd - <span class="keyword">int</span>(<span class="number">90</span> - zd)) * <span class="number">60</span> - <span class="keyword">int</span>((<span class="number">90</span> - zd - <span class="keyword">int</span>(<span class="number">90</span> - zd)) * <span class="number">60</span>)) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; az 方位 : &quot;</span> &lt;&lt; <span class="keyword">int</span>(az) &lt;&lt; <span class="string">&quot; ram: &quot;</span> &lt;&lt; <span class="keyword">int</span>((az - <span class="keyword">int</span>(az)) * <span class="number">60</span>) &lt;&lt; <span class="string">&quot; ras: &quot;</span> &lt;&lt; <span class="number">60</span> * ((az - <span class="keyword">int</span>(az)) * <span class="number">60</span> - <span class="keyword">int</span>((az - <span class="keyword">int</span>(az)) * <span class="number">60</span>)) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// double tdb,</span></span><br><span class="line">    <span class="comment">//     time2, peb[3], veb[3], pes[3], ves[3], pos1[3], pos2[3], pos3[3], pos4[3], pos5[3], pos6[3], pos7[3], vel1[3];</span></span><br><span class="line"></span><br><span class="line">    rah = ra;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; &quot; ra: &quot; &lt;&lt; fk5_ra;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; rah: &quot;</span> &lt;&lt; <span class="keyword">int</span>(rah) &lt;&lt; <span class="string">&quot; ram: &quot;</span> &lt;&lt; <span class="keyword">int</span>((rah - <span class="keyword">int</span>(rah)) * <span class="number">60</span>) &lt;&lt; <span class="string">&quot; ras: &quot;</span> &lt;&lt; <span class="number">60</span> * ((rah - <span class="keyword">int</span>(rah)) * <span class="number">60</span> - <span class="keyword">int</span>((rah - <span class="keyword">int</span>(rah)) * <span class="number">60</span>)) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; fk5_dec &lt;&lt; endl;</span></span><br><span class="line">    <span class="keyword">double</span> dech = dec;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; dech: &quot;</span> &lt;&lt; (dech &lt; <span class="number">0</span> ? <span class="string">&quot;-&quot;</span> : <span class="string">&quot;&quot;</span>) &lt;&lt; <span class="built_in">abs</span>(<span class="keyword">int</span>(dech)) &lt;&lt; <span class="string">&quot; ram: &quot;</span> &lt;&lt; <span class="built_in">abs</span>(<span class="keyword">int</span>((dech - <span class="keyword">int</span>(dech)) * <span class="number">60</span>)) &lt;&lt; <span class="string">&quot; ras: &quot;</span> &lt;&lt; <span class="built_in">abs</span>(<span class="number">60</span> * ((dech - <span class="keyword">int</span>(dech)) * <span class="number">60</span> - <span class="keyword">int</span>((dech - <span class="keyword">int</span>(dech)) * <span class="number">60</span>))) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">tsuiwade</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://tsuiwade.github.io/2022/12/10/blog68-study3/">https://tsuiwade.github.io/2022/12/10/blog68-study3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://tsuiwade.github.io" target="_blank">TsuiWade's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%A7%91%E7%A0%94/">科研</a></div><div class="post_share"><div class="social-share" data-image="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221210165212635.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">不给糖就捣蛋</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></button></div><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/12/06/blog67-study2/"><img class="next-cover" src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221126191150684.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">冲毕业第二、三周记录</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/11/22/blog66-study1/" title="冲毕业第一周记录"><img class="cover" src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221122152053959.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-22</div><div class="title">冲毕业第一周记录</div></div></a></div><div><a href="/2022/12/06/blog67-study2/" title="冲毕业第二、三周记录"><img class="cover" src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221126191150684.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-06</div><div class="title">冲毕业第二、三周记录</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/1a27de723e1cb04e5acd82cbf4146166_31ebbe760ba45b872b1b8f6c19eb6246.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">tsuiwade</div><div class="author-info__description">记录技术生活的点点滴滴</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">23</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/tsuiwade"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/tsuiwade" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:478451541@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/381957255" target="_blank" title="bilibili"><i class="iconfont  icon-bilibili"></i></a><a class="social-icon" href="/img/alipay.jpg" target="_blank" title="alipay"><i class="fab  fa-alipay"></i></a><a class="social-icon" href="/img/wechat.jpg" target="_blank" title="wechat"><i class="fab  fa-weixin"></i></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=478451541" target="_blank" title="qq"><i class="fab  fa-qq"></i></a><a class="social-icon" href="https://blog.csdn.net/" target="_blank" title="CSDN"><i class="iconfont  icon-csdn3"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=321642197" target="_blank" title="wangyiyun"><i class="iconfont  icon-wangyiyunyinyuemusic1193417easyiconnet"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">#include &lt;bits&#x2F;stdc++.h&gt;
using namespace std;
const double TWOPI &#x3D; 6.28318530717958647692;
const double DEG2RAD &#x3D; 0.017453292519943296;
const double RAD2DEG &#x3D; 57.295779513082321;
const double RAD2SEC &#x3D; 206264.806247096355;
const double epoch_hip &#x3D; 2448349.0625; &#x2F;&#x2F; J1991.25
const double epoch_fk5 &#x3D; 2451545.0000;

&#x2F;*
ARGUMENTS:
    in :
        hip_ra (rad)
        hip_dec (rad)
        hip_promora (mas&#x2F;yr)
        hip_promodec (mas&#x2F;yr)
        hip_parallax (mas)
    out :
        fk5_ra(h)
        fk5_dec(degree)
*&#x2F;
void convert(double hip_ra, double hip_dec, double hip_promora, double hip_promodec, double hip_parallax, double &amp;fk5_ra, double &amp;fk5_dec)
&amp;#123;
    hip_ra &#x3D; hip_ra * RAD2DEG &#x2F; 15.0;
    hip_promora &#x3D; hip_promora &#x2F; (150.0 * cos(hip_dec));
    hip_dec *&#x3D; RAD2DEG;
    hip_promodec &#x2F;&#x3D; 10.0;
    hip_parallax &#x2F;&#x3D; 1000.0;
    if (hip_parallax &lt;&#x3D; 0.0)
        hip_parallax &#x3D; 1.0e-7;
    double dist &#x3D; RAD2SEC &#x2F; hip_parallax;
    double r &#x3D; hip_ra * 54000.0 &#x2F; RAD2SEC;
    double d &#x3D; hip_dec * 3600.0 &#x2F; RAD2SEC;
    double cra, sra, cdc, sdc, pos1[3], term1, pmr, pmd, vel1[3], pos2[3], xyproj;
    cra &#x3D; cos(r);
    sra &#x3D; sin(r);
    cdc &#x3D; cos(d);
    sdc &#x3D; sin(d);
    pos1[0] &#x3D; dist * cdc * cra;
    pos1[1] &#x3D; dist * cdc * sra;
    pos1[2] &#x3D; dist * sdc;
    term1 &#x3D; hip_parallax * 36525.0;
    pmr &#x3D; hip_promora * 15.0 * cdc &#x2F; term1;
    pmd &#x3D; hip_promodec &#x2F; term1;
    vel1[0] &#x3D; -pmr * sra - pmd * sdc * cra;
    vel1[1] &#x3D; pmr * cra - pmd * sdc * sra;
    vel1[2] &#x3D; pmd * cdc;
    for (int j &#x3D; 0; j &lt; 3; j++)
    &amp;#123;
        pos2[j] &#x3D; pos1[j] + vel1[j] * (epoch_fk5 - epoch_hip);
    &amp;#125;
    xyproj &#x3D; sqrt(pos2[0] * pos2[0] + pos2[1] * pos2[1]);
    r &#x3D; atan2(pos2[1], pos2[0]);
    d &#x3D; atan2(pos2[2], xyproj);
    fk5_ra &#x3D; r * RAD2SEC &#x2F; 54000.0;
    fk5_dec &#x3D; d * RAD2SEC &#x2F; 3600.0;
    if (fk5_ra &lt; 0.0)
        fk5_ra +&#x3D; 24.0;
&amp;#125;

int main()
&amp;#123;
    double hip_ra &#x3D; 6.011119421;
    double hip_dec &#x3D; -0.516998583;
    double hip_promora &#x3D; 328.95;
    double hip_promodec &#x3D; -164.67;
    double hip_parallax &#x3D; 129.81;
    double fk5_ra, fk5_dec;

    convert(hip_ra, hip_dec, hip_promora, hip_promodec, hip_parallax, fk5_ra, fk5_dec);

    double rah &#x3D; fk5_ra;
    cout &lt;&lt; &quot; ra: &quot; &lt;&lt; fk5_ra;

    cout &lt;&lt; &quot; rah: &quot; &lt;&lt; int(rah) &lt;&lt; &quot; ram: &quot; &lt;&lt; int((rah - int(rah)) * 60) &lt;&lt; &quot; ras: &quot; &lt;&lt; 60 * ((rah - int(rah)) * 60 - int((rah - int(rah)) * 60)) &lt;&lt; endl;
    cout &lt;&lt; fk5_dec &lt;&lt; endl;
    double dech &#x3D; fk5_dec;
    cout &lt;&lt; &quot; dech &quot; &lt;&lt; int(dech) &lt;&lt; &quot; ram: &quot; &lt;&lt; int((dech - int(dech)) * 60) &lt;&lt; &quot; ras: &quot; &lt;&lt; 60 * ((dech - int(dech)) * 60 - int((dech - int(dech)) * 60)) &lt;&lt; endl;
    system(&quot;pause&quot;);
    return 0;
&amp;#125;
</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/12/10/blog68-study3/" title="冲毕业第四周记录"><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221210165212635.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="冲毕业第四周记录"/></a><div class="content"><a class="title" href="/2022/12/10/blog68-study3/" title="冲毕业第四周记录">冲毕业第四周记录</a><time datetime="2022-12-10T16:57:34.000Z" title="发表于 2022-12-10 16:57:34">2022-12-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/06/blog67-study2/" title="冲毕业第二、三周记录"><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221126191150684.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="冲毕业第二、三周记录"/></a><div class="content"><a class="title" href="/2022/12/06/blog67-study2/" title="冲毕业第二、三周记录">冲毕业第二、三周记录</a><time datetime="2022-12-06T16:30:34.000Z" title="发表于 2022-12-06 16:30:34">2022-12-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/22/blog66-study1/" title="冲毕业第一周记录"><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221122152053959.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="冲毕业第一周记录"/></a><div class="content"><a class="title" href="/2022/11/22/blog66-study1/" title="冲毕业第一周记录">冲毕业第一周记录</a><time datetime="2022-11-22T15:17:15.000Z" title="发表于 2022-11-22 15:17:15">2022-11-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/23/blog61-interviewRecord/" title="面试记录"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="面试记录"/></a><div class="content"><a class="title" href="/2022/08/23/blog61-interviewRecord/" title="面试记录">面试记录</a><time datetime="2022-08-23T12:25:35.000Z" title="发表于 2022-08-23 12:25:35">2022-08-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/18/blog64-smartptr/" title="c++11新特性"><img src="https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/c-11.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="c++11新特性"/></a><div class="content"><a class="title" href="/2022/08/18/blog64-smartptr/" title="c++11新特性">c++11新特性</a><time datetime="2022-08-18T14:05:05.000Z" title="发表于 2022-08-18 14:05:05">2022-08-18</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://images-1312692717.cos.ap-nanjing.myqcloud.com/img/image-20221210165212635.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By tsuiwade</div><div class="footer_custom_text"><p><a style="margin-inline:5px"target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为 Hexo" alt="HEXO"></a><a style="margin-inline:5px"target="_blank" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用 Butterfly" alt="Butterfly"></a><a style="margin-inline:5px"target="_blank" href="https://www.jsdelivr.com/"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="本站使用 Jsdelivr 为静态资源提供CDN加速" alt="Jsdelivr"></a><a style="margin-inline:5px"target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由 GitHub 托管" alt="GitHub"></a><a style="margin-inline:5px"target="_blank"href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" alt="img" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div><div id="workboard"><script async="async" src="/js/runtime.js"></script></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'mjS6lvGtY7MvAlxolqz8OdMn-gzGzoHsz',
      appKey: 'QakpY3QuhiOscnuh50tI450M',
      placeholder: '留下你的足迹吧~~',
      avatar: 'monsterid',
      meta: 'nick'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/js/hideMobileSidebar.js"></script><script defer src="https://cdn.jsdelivr.net/gh/graingert/wow@1.3.0/dist/wow.min.js"></script><script data-pjax src="/js/myjs.js"></script><script data-pjax src="/js/githubcalendar.js"></script><script data-pjax src="/js/giteecalendar.js"></script><script defer data-pjax src="/js/wow_init.js"></script><script src="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/js/mouse_snow.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@latest/source/js/issues.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>function history_calendar_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>那年今日</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>';
                console.log('已挂载history_calendar')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='all'|| 'all' ==='all')){

            history_calendar_injector_config()
        } </script><script data-pjax  src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script data-pjax>function electric_clock_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img id="card-clock-loading" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-clock/clock/images/weather/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading" class="entered loading"></div></div></div></div></div>';
                console.log('已挂载electric_clock')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='all'|| 'all' ==='all')){

            electric_clock_injector_config()
        } </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax  src="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.js"></script>
  <script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://python-github-calendar-api.vercel.app/api?tsuiwade";
            var git_color =['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'];
            var git_user ="tsuiwade";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log('已挂载github calendar')
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end --></body></html>